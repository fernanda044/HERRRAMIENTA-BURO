<!doctype html>
<html lang="es" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de AnÃ¡lisis de Riesgo Crediticio</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-500 to-purple-600">
    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">SISTEMA DE ANALISIS DE CREDITO  </h1>
            <p class="text-blue-100 text-lg">EvaluaciÃ³n por niveles de riesgo para evaluar sujetos a credito</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- CUADRO 1: RIESGO BAJO -->
            <div id="cuadro1" class="bg-white rounded-xl shadow-2xl p-6 border-t-4 border-green-500">
    <div class="flex items-center mb-4">
        <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
        <h2 class="text-2xl font-bold text-gray-800">RIESGO BAJO</h2>
    </div>

    <div id="inicio-bajo" class="question-container">
        <h3 class="font-semibold text-gray-700 mb-4">EvaluaciÃ³n de Riesgo Bajo</h3>
        <p class="text-sm text-gray-600 mb-4">Inicia la evaluaciÃ³n directa para determinar si el cliente califica como riesgo bajo.</p>
        <button onclick="mostrarPregunta('1-1-inicio')" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
            ğŸ” Iniciar EvaluaciÃ³n Riesgo Bajo
        </button>
    </div>

    <div id="pregunta1-1-inicio" class="question-container hidden">
        <h3 class="font-semibold text-gray-700 mb-3">1.1.0 Revisa en la columna "HISTORICO DE PAGO" Â¿aparecen las siguientes leyendas?:</h3>
        <ul class="text-sm text-gray-600 mb-4 space-y-1">
            <li>a) Fraude</li>
            <li>b) Cuenta fraudulenta</li>
            <li>c) Ilocalizable</li>
            <li>d) En localizaciÃ³n</li>
        </ul>
        <div class="space-y-3">
            <button onclick="aprobarRiesgoAlto()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                SÃ­ 
            </button>
            <button onclick="mostrarPregunta('1-1')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">

                No 
            </button>
        </div>
    </div>

    <div id="pregunta1-1" class="question-container hidden">
        <h3 class="font-semibold text-gray-700 mb-4">1.1 Â¿Se identifican cuentas con MOP 01 hasta 04?</h3>
        <div class="space-y-3">
            <button onclick="aprobarRiesgoBajo()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                SÃ­
            </button>
            <button onclick="mostrarPregunta('1-2')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                No
            </button>
        </div>
    </div>

    <div id="pregunta1-2" class="question-container hidden">
        <h3 class="font-semibold text-gray-700 mb-3">1.2 Â¿Se identifican en la columna â€œtipo de crÃ©dito cuenta responsabilidadâ€ lo siguiente?:</h3>
        <ul class="text-sm text-gray-600 mb-4 space-y-1">
            <li>a) Tarjetas de crÃ©dito sin distinciÃ³n del otorgante</li>
            <li>b) LÃ­neas de crÃ©dito</li>
            <li>c) CrÃ©ditos o prÃ©stamos revolventes</li>
        </ul>
        <p class="text-xs text-gray-600 mb-3 italic">Nota: Exceptuando a que el otorgante corresponda a comunicaciones</p>
        <div class="space-y-3">
            <button onclick="mostrarPregunta('1-3')" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                SÃ­
            </button>
            <button onclick="mostrarPregunta('1-4-inicio')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                No 
            </button>
        </div>
    </div>

    <div id="pregunta1-3" class="question-container hidden">
        <h3 class="font-semibold text-gray-700 mb-4">1.3 Identifica si en la columna de apertura y Ãºltima compra, correspondan a la misma fecha Â¿coinciden?</h3>
        <div class="space-y-3">
            <button onclick="aprobarRiesgoBajo()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                SÃ­
            </button>
            <button onclick="mostrarPregunta('1-4-inicio')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                No 
            </button>
        </div>
    </div>

    <div id="resultado-bajo" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg">
        <strong>âœ… APROBADO - RIESGO BAJO</strong><br>
        <span class="text-sm">SUJETO A CRÃ‰DITO</span>
        <button onclick="reiniciarSistema()" class="mt-3 w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
            ğŸ”„ Nuevo AnÃ¡lisis
        </button>
    </div>
</div>


            <!-- CUADRO 2: RIESGO MEDIO -->
<div id="cuadro2" class="bg-white rounded-xl shadow-2xl p-6 border-t-4 border-yellow-500">
    <div class="flex items-center mb-4">
        <div class="w-3 h-3 bg-yellow-500 rounded-full mr-3"></div>
        <h2 class="text-2xl font-bold text-gray-800">RIESGO MEDIO</h2>
    </div>

    <div id="inicio-medio" class="question-container">
        <h3 class="font-semibold text-gray-700 mb-4">EvaluaciÃ³n de Riesgo Medio</h3>
        <p class="text-sm text-gray-600 mb-4">Inicia la evaluaciÃ³n directa para determinar si el cliente califica como riesgo medio.</p>
        <button onclick="mostrarPregunta('1-4-inicio')" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">ğŸ” Iniciar EvaluaciÃ³n Riesgo Medio
        </button>
    </div>

    <div id="pregunta1-4-inicio" class="question-container hidden">
        <h3 class="font-semibold text-gray-700 mb-3">1.4.0 Revisa en la columna "HISTORICO DE PAGO" Â¿aparecen las siguientes leyendas?:</h3>
        <ul class="text-sm text-gray-600 mb-4 space-y-1">
            <li>a) Fraude</li>
            <li>b) Cuenta fraudulenta</li>
            <li>c) Ilocalizable</li>
            <li>d) En localizaciÃ³n</li>
        </ul>
        <div class="space-y-3">
            <button onclick="aprobarRiesgoAlto()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                SÃ­ 
            </button>
            <button onclick="mostrarPregunta('1-4')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                No 
            </button>
        </div>
    </div>

                <div id="pregunta1-4" class="question-container hidden">
                    <h3 class="font-semibold text-gray-700 mb-4">1.4 Â¿Cuenta con historial mÃ­nimo de un crÃ©dito pagado en la Cooperativa Acreimex?</h3>
                    <div class="space-y-3">
                        <button onclick="aprobarRiesgoMedio()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            SÃ­
                        </button>
                        <button onclick="mostrarPregunta('1-5')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            No
                        </button>
                    </div>
                </div>

                <div id="pregunta1-5" class="question-container hidden">
                    <h3 class="font-semibold text-gray-700 mb-4">1.5 Â¿La cuenta es muy reciente para ser calificada "Mop 0" o cuenta sin informaciÃ³n "U"?</h3>
                    <div class="space-y-3">
                        <button onclick="aprobarRiesgoMedio()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            SÃ­ - nueva/reciente
                        </button>
                        <button onclick="mostrarPregunta('1-6')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            No 
                        </button>
                    </div>
                </div>

                <div id="pregunta1-6" class="question-container hidden">
                    <h3 class="font-semibold text-gray-700 mb-4">1.6 REVISA! Cuentas con MOPÂ´S 05, 06, 07, 9, 96 o 97 en la columna "monto". Â¿Refleja un monto de hasta $5,000.00?</h3>
                    <div class="space-y-3">
                        <button onclick="aprobarRiesgoMedio()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            SÃ­ ($5,000 o menos)
                        </button>
                        <button onclick="mostrarPregunta('1-7')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            No (+$5,000)
                        </button>
                    </div>
                </div>

                <div id="pregunta1-7" class="question-container hidden">
                    <h3 class="font-semibold text-gray-700 mb-4">1.7 Â¿Aparecen 5 o mÃ¡s crÃ©ditos grupales pagados en consecutivo de MOPÂ´S 01 y/o 02, en los que el ciclo mÃ¡s reciente no rebase un aÃ±o del Ãºltimo pago?</h3>
                    <div class="space-y-3">
                                                        </ul>
                                  <p class="text-xs text-gray-600 mb-3 italic">Nota: puedes usar la "guÃ­a crÃ©ditos grupales" para apoyarte a identificarlos.</p>
                        <button onclick="aprobarRiesgoMedio()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            SÃ­ (-1 aÃ±o)
                        </button>
                        <button onclick="mostrarPregunta('1-8')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            No (+1 aÃ±o)
                    </div>
                </div>

                <div id="pregunta1-8" class="question-container hidden">
                    <h3 class="font-semibold text-gray-700 mb-3">1.8 Â¡Sin importar el MOP! Cuentas que en la columna de otorgante aparezcan como:</h3>
                    <ul class="text-sm text-gray-600 mb-4 space-y-1">
                        <li>a) Gubernamentales</li>
                        <li>b) Comunicaciones</li>
                        <li>c) Servicios</li>
                        <li>d) MembresÃ­as</li>
                    </ul>
                    <p class="text-sm font-medium text-gray-700 mb-4">Â¿En la columna "monto" refleja una cantidad de hasta $8,000.00?</p>
                    <div class="space-y-3">
                        <button onclick="aprobarRiesgoMedio()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            SÃ­ ($8,000 o menos)
                        </button>
                        <button onclick="mostrarPregunta('1-9-medio')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            No (+$8,000)
                        </button>
                    </div>
                </div>

                <div id="pregunta1-9-medio" class="question-container hidden">
                    <h3 class="font-semibold text-gray-700 mb-4">1.9 Â¡Identifica! Cuentas con MOPÂ´S 05 - 07 Â¿su â€œÃºltimo pagoâ€ es mayor a un aÃ±o que la fecha de consulta?</h3>
                    <div class="space-y-3">
                            </ul>
                            <p class="text-xs text-gray-600 mb-3 italic">Nota: En caso de no contar con la fecha de "Ãºltimo pago" en los puntos donde se hace referencia, se deberÃ¡ considerar la fecha de "Ãºltima compra".</p>
                        <button onclick="mostrarPregunta('1-9-1-medio')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            No (menor a un aÃ±o)
                        </button>
                        <button onclick="mostrarPregunta('2.0-medio')" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            SÃ­ (mayor a un aÃ±o)
                        </button>
                    </div>
                    </div>
                <div id="pregunta2.0-medio" class="question-container hidden">
                    <h3 class="font-semibold text-gray-700 mb-4">2.0 Â¡REVISA! Si refleja un crÃ©dito grupal pagado con Mop 01 dentro de los doce meses anteriores a la fecha de consulta.</h3>
                    <div class="space-y-3">
                            </ul>
                            <p class="text-xs text-gray-600 mb-3 italic">NOTA:PUEDES APOYARTE DE LA â€œGUIA CREDITOS GRUPALESâ€ PARA IDENTIFICALOS .</p>
                        <button onclick="mostrarPregunta('2-1')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            No
                        </button>
                        <button onclick="aprobarRiesgoMedio()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            SÃ­ 
                        </button>
                    </div>
                    </div>
                <div id="pregunta1-9-1-medio" class="question-container hidden">
                    <h3 class="font-semibold text-gray-700 mb-4">1.9.1 Calculadora de LÃ­mite 20%</h3>
                    <p class="text-sm text-gray-600 mb-4">Si el Ãºltimo pago es menor a un aÃ±o, no se deberÃ¡ rebasar el 20% de la suma de todos los saldos actuales.</p>
                    
                    <div class="space-y-4">
                        <div>
                            <label for="sumaTotalSaldosMedio" class="block text-sm font-medium text-gray-700 mb-2">Suma total de todos los saldos:</label>
                            <input type="number" id="sumaTotalSaldosMedio" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="0.00" oninput="calcularLimiteMedio()">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">20% LÃ­mite permitido:</label>
                            <div id="limitePermitidoMedio" class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-lg text-gray-700">$0.00</div>
                        </div>
                        
                        <div>
                            <label for="saldoMopsMedio" class="block text-sm font-medium text-gray-700 mb-2">Saldo actual de MOPS 5, 6, 7:</label>
                            <input type="number" id="saldoMopsMedio" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="0.00" oninput="calcularLimiteMedio()">
                        </div>
                        
                        <div id="resultadoCalculoMedio" class="hidden">
                            <div class="p-4 rounded-lg border">
                                <div id="resultadoTextoMedio" class="font-medium"></div>
                                <div class="mt-3 space-y-2">
                                    <button id="btnAprobarCalculoMedio" onclick="aprobarRiesgoMedio()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors hidden">
                                        Aprobar - Riesgo Medio Sujeto a CrÃ©dito
                                    </button>
                                    <button id="btnContinuarCalculoMedio" onclick="mostrarPregunta('2-1')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg transition-colors hidden">
                                        Continuar a Riesgo Alto
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="resultado-medio" class="hidden bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded-lg">
                    <strong>âš ï¸ APROBADO - RIESGO MEDIO</strong><br>
                    <span class="text-sm">SUJETO A CRÃ‰DITO</span>
                    <button onclick="mostrarAnalisis('medio')" class="mt-3 w-full bg-yellow-600 hover:bg-yellow-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        ğŸ“Š Ver AnÃ¡lisis Detallado
                    </button>
                </div>
            </div>

            <!-- CUADRO 3: RIESGO ALTO -->
            <div id="cuadro3" class="bg-white rounded-xl shadow-2xl p-6 border-t-4 border-red-500">
                <div class="flex items-center mb-4">
                    <div class="w-3 h-3 bg-red-500 rounded-full mr-3"></div>
                    <h2 class="text-2xl font-bold text-gray-800">RIESGO ALTO</h2>
                </div>

                <div id="inicio-alto" class="question-container">
                    <h3 class="font-semibold text-gray-700 mb-4">EvaluaciÃ³n de Riesgo Alto</h3>
                    <p class="text-sm text-gray-600 mb-4">Inicia la evaluaciÃ³n directa para determinar si el cliente califica como riesgo alto.</p>
                    <button onclick="mostrarPregunta('2-1')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                        ğŸ” Iniciar EvaluaciÃ³n Riesgo Alto
                    </button>
                </div>



                <div id="pregunta2-1" class="question-container hidden">
                    <h3 class="font-semibold text-gray-700 mb-3">2.1 Revisa en la columna "HISTORICO DE PAGO" Â¿aparecen las siguientes leyendas?:</h3>
                    <ul class="text-sm text-gray-600 mb-4 space-y-1">
                        <li>a) Fraude</li>
                        <li>b) Cuenta fraudulenta</li>
                        <li>c) Ilocalizable</li>
                        <li>d) En localizaciÃ³n</li>
                    </ul>
                    <div class="space-y-3">
                        <button onclick="aprobarRiesgoAlto()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            SÃ­
                        </button>
                        <button onclick="mostrarPregunta('2-1-1')" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            No
                        </button>
                    </div>
                </div>

                <div id="pregunta2-1-1" class="question-container hidden">
                    <h3 class="font-semibold text-gray-700 mb-3">2.1.1 Â¡Revisa!  Â¿contiene en la columna "HISTORICO DE PAGOS" alguna de las siguientes leyendas?:</h3>
                    <ul class="text-sm text-gray-600 mb-4 space-y-1">
                        <li>a) Finiquito y/o quita</li>
                        <li>b) Deuda total y/o parcial sin recuperar</li>
                        <li>c) Castigo y/o quebranto</li>
                        <li>d) Concurso mercantil</li>
                    </ul>
                    <div class="space-y-3">
                        <button onclick="mostrarPregunta('2-2')" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            SÃ­
                        </button>
                        <button onclick="aprobarRiesgoAltoCredito()" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            No
                        </button>
                    </div>
                </div>

                <div id="pregunta2-2" class="question-container hidden">
                    <h3 class="font-semibold text-gray-700 mb-4">2.2 Â¿El "saldo actual" de la cuenta es menor a $7,000.00?</h3>
                    <div class="space-y-3">
                        <button onclick="mostrarPregunta('2-5')" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            ($7,000 o menos)
                        </button>
                        <button onclick="aprobarRiesgoAlto()" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            (+$7,000) 
                        </button>
                    </div>
                </div>

                <div id="pregunta2-5" class="question-container hidden">
                    <h3 class="font-semibold text-gray-700 mb-4">2.5 Â¿Su Ãºltimo pago es mayor a 4 aÃ±os?</h3>
                    <div class="space-y-3">
                        <button onclick="aprobarRiesgoAlto()" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            (no)
                        </button>
                        <button onclick="mostrarPregunta('2-6')" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            (si)
                        </button>
                    </div>
                </div>

                <div id="pregunta2-6" class="question-container hidden">
                    <h3 class="font-semibold text-gray-700 mb-4">2.6 Â¿Tiene dos crÃ©ditos pagados con MOP 01?</h3>
                    <div class="space-y-3">
                        <button onclick="aprobarRiesgoAlto()" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            No
                        </button>
                        <button onclick="aprobarRiesgoAltoCredito()" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                            SÃ­
                        </button>
                    </div>
                </div>

                <div id="resultado-alto" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg">
                    <strong>ğŸš« RIESGO ALTO</strong><br>
                    <span class="text-sm">NO SUJETO A CRÃ‰DITO</span>
                    <button onclick="mostrarAnalisis('alto-no')" class="mt-3 w-full bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        ğŸ“Š Ver AnÃ¡lisis Detallado
                    </button>
                </div>

                <div id="resultado-alto-credito" class="hidden bg-orange-100 border border-orange-400 text-orange-700 px-4 py-3 rounded-lg">
                    <strong>âš ï¸ RIESGO ALTO</strong><br>
                    <span class="text-sm">SUJETO A CRÃ‰DITO</span>
                    <button onclick="mostrarAnalisis('alto-si')" class="mt-3 w-full bg-orange-600 hover:bg-orange-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        ğŸ“Š Ver AnÃ¡lisis Detallado
                    </button>
                </div>
            </div>
        </div>

        <!-- Botones de control -->
<div class="text-center space-x-4">
<button onclick="regresarPregunta()" class="bg-white hover:bg-gray-100 text-gray-800 font-medium py-3 px-6 rounded-lg shadow-lg transition-colors">
        ğŸ”™ Pregunta Anterior
    </button>
    <button onclick="reiniciarSistema()" class="bg-white hover:bg-gray-100 text-gray-800 font-medium py-3 px-6 rounded-lg shadow-lg transition-colors">
        ğŸ”„ Reiniciar AnÃ¡lisis
    </button>
    <button onclick="mostrarGuiaCreditos()" class="bg-white hover:bg-gray-100 text-gray-800 font-medium py-3 px-6 rounded-lg shadow-lg transition-colors">
        ğŸ“‹ GuÃ­a CrÃ©ditos Grupales
    </button>
</div>

    <!-- Modal de alertas -->
    <div id="modalAlerta" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-md mx-4 shadow-2xl">
            <div class="text-center">
                <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-2xl">âš ï¸</span>
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">AtenciÃ³n</h3>
                <p id="textoAlerta" class="text-gray-600 mb-6"></p>
                <button onclick="cerrarModal()" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                    Entendido
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de guÃ­a de crÃ©ditos grupales -->
    <div id="modalGuiaCreditos" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-5xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 rounded-t-xl">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                            <span class="text-2xl">ğŸ“‹</span>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">ClasificaciÃ³n de CrÃ©ditos Grupales</h3>
                            <p class="text-sm text-gray-600">GuÃ­a para identificar crÃ©ditos grupales en el reporte SIC</p>
                        </div>
                    </div>
                    <button onclick="cerrarGuiaCreditos()" class="text-gray-400 hover:text-gray-600 text-2xl font-bold">Ã—</button>
                </div>
            </div>
            
            <div class="p-6">
                <div class="mb-6">
                    <p class="text-gray-700 text-sm mb-4">
                        <strong>Instrucciones:</strong> Cuando en el reporte de la SIC se den los siguientes supuestos, se consideran crÃ©ditos grupales:
                    </p>
                </div>

                <div class="space-y-6">
                    <!-- Supuesto I -->
                    <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center mr-3 font-bold text-sm">I</div>
                            <h4 class="text-lg font-semibold text-green-800">Primer Supuesto</h4>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="font-medium text-green-700 mb-2">Columna "TIPO DE CRÃ‰DITO" debe contener:</h5>
                                <ul class="space-y-1 text-sm text-green-600">
                                    <li class="flex items-center"><span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>"CON COLATERAL"</li>
                                    <li class="flex items-center"><span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>"OBLIGADO SOLIDARIO"</li>
                                    <li class="flex items-center"><span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>"MANCUMUNADO"</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h5 class="font-medium text-green-700 mb-2">Columna "MONTO A PAGAR" - Forma de pago:</h5>
                                <ul class="space-y-1 text-sm text-green-600">
                                    <li class="flex items-center"><span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>SEMANAL</li>
                                    <li class="flex items-center"><span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>CATORCENAL</li>
                                    <li class="flex items-center"><span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>QUINCENAL O VARIABLE</li>
                                </ul>
                                <div class="mt-3 p-2 bg-green-100 rounded-lg">
                                    <p class="text-xs text-green-700"><strong>CondiciÃ³n:</strong> A un plazo de hasta 10 meses</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Supuesto II -->
                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center mr-3 font-bold text-sm">II</div>
                            <h4 class="text-lg font-semibold text-blue-800">Segundo Supuesto</h4>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="font-medium text-blue-700 mb-2">Columna "TIPO DE CRÃ‰DITO" debe especificar:</h5>
                                <ul class="space-y-1 text-sm text-blue-600">
                                    <li class="flex items-center"><span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>"PRESTAMO PERSONAL PAGOS FIJOS INDIVIDUAL"</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h5 class="font-medium text-blue-700 mb-2">Columna "MONTO A PAGAR" - Forma de pago:</h5>
                                <ul class="space-y-1 text-sm text-blue-600">
                                    <li class="flex items-center"><span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>16 â€“ 52 SEMANAS</li>
                                    <li class="flex items-center"><span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>8 â€“ 24 CATORCENAS, QUINCENAS O VARIABLE</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mt-4 p-3 bg-red-100 border border-red-200 rounded-lg">
                            <h6 class="font-medium text-red-700 mb-1">âš ï¸ EXCLUSIÃ“N IMPORTANTE:</h6>
                            <p class="text-sm text-red-600">NO se consideran cuando el otorgante aparezca como <strong>"TIENDA COMERCIAL"</strong></p>
                        </div>
                    </div>

                    <!-- Supuesto III -->
                    <div class="bg-purple-50 border border-purple-200 rounded-xl p-6">
                        <div class="flex items-center mb-4">
                            <div class="w-8 h-8 bg-purple-600 text-white rounded-full flex items-center justify-center mr-3 font-bold text-sm">III</div>
                            <h4 class="text-lg font-semibold text-purple-800">Tercer Supuesto</h4>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="font-medium text-purple-700 mb-2">Columna "TIPO DE CRÃ‰DITO" debe especificar:</h5>
                                <ul class="space-y-1 text-sm text-purple-600">
                                    <li class="flex items-center"><span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>"CON COLATERAL (PFAE) PAGOS INDIVIDUAL"</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h5 class="font-medium text-purple-700 mb-2">Columna "MONTO A PAGAR" - Forma de pago:</h5>
                                <ul class="space-y-1 text-sm text-purple-600">
                                    <li class="flex items-center"><span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>MENSUAL CON PLAZO DE 16</li>
                                    <li class="flex items-center"><span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>VARIABLE CON PLAZO DE 16</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resumen de verificaciÃ³n -->
                <div class="mt-6 bg-gray-50 border border-gray-200 rounded-xl p-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">âœ…</span> Lista de VerificaciÃ³n
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <h5 class="font-medium text-gray-700 mb-2">Pasos para identificar:</h5>
                            <ol class="space-y-1 text-gray-600">
                                <li>1. Revisar columna "TIPO DE CRÃ‰DITO"</li>
                                <li>2. Verificar columna "MONTO A PAGAR"</li>
                                <li>3. Confirmar plazos y condiciones</li>
                                <li>4. Verificar exclusiones (si aplican)</li>
                            </ol>
                        </div>
                        <div>
                            <h5 class="font-medium text-gray-700 mb-2">Elementos clave:</h5>
                            <ul class="space-y-1 text-gray-600">
                                <li>â€¢ Tipo de garantÃ­a o responsabilidad</li>
                                <li>â€¢ Frecuencia de pagos</li>
                                <li>â€¢ Plazo del crÃ©dito</li>
                                <li>â€¢ Tipo de otorgante</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="mt-6 flex justify-center">
                    <button onclick="cerrarGuiaCreditos()" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-3 px-8 rounded-lg transition-colors">
                        Cerrar GuÃ­a
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de anÃ¡lisis -->
    <div id="modalAnalisis" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 rounded-t-xl">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div id="iconoAnalisis" class="w-12 h-12 rounded-full flex items-center justify-center mr-4">
                            <span class="text-2xl">ğŸ“Š</span>
                        </div>
                        <div>
                            <h3 id="tituloAnalisis" class="text-xl font-bold text-gray-800">AnÃ¡lisis de Riesgo Crediticio</h3>
                            <p id="subtituloAnalisis" class="text-sm text-gray-600">EvaluaciÃ³n detallada del perfil crediticio</p>
                        </div>
                    </div>
                    <button onclick="cerrarAnalisis()" class="text-gray-400 hover:text-gray-600 text-2xl font-bold">Ã—</button>
                </div>
            </div>
            
            <div class="p-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Resultado Final -->
                    <div class="lg:col-span-2">
                        <div id="resultadoFinalAnalisis" class="p-6 rounded-xl border-2"> 
                            <div class="flex items-center mb-4">
                                <div id="iconoResultado" class="w-8 h-8 rounded-full flex items-center justify-center mr-3">
                                    <span class="text-lg">âœ…</span>
                                </div>
                                <h4 id="textoResultado" class="text-lg font-bold">APROBADO - RIESGO BAJO</h4>
                            </div>
                            <p id="descripcionResultado" class="text-gray-700">El solicitante cumple con todos los criterios para ser considerado de riesgo bajo y es sujeto a crÃ©dito.</p>
                        </div>
                    </div>

                    <!-- PolÃ­ticas Cumplidas -->
                        </h4>
                    </div>

                    <!-- Factores de Riesgo -->
                        </h4>
                            <!-- Se llena dinÃ¡micamente -->
                        </ul>
                    </div>



                    <!-- Recomendaciones -->
                        </h4>
                            <!-- Se llena dinÃ¡micamente -->
                        </ul>
                    </div>
    </div>
    
   <script>
     Â  Â  Â  function mostrarPregunta(id) {
Â  Â  // 1. Ocultar todas las preguntas abiertas actualmente
Â  Â  const preguntas = document.querySelectorAll('.question-container');
Â  Â  preguntas.forEach(p => p.classList.add('hidden'));

Â  Â  // 2. Mostrar la pregunta especÃ­fica
Â  Â  const destino = document.getElementById('pregunta' + id);
Â  Â  if (destino) {
Â  Â  Â  Â  destino.classList.remove('hidden');
Â  Â  } else {
Â  Â  Â  Â  // Por si el ID no lleva el prefijo 'pregunta'
Â  Â  Â  Â  const destinoDirecto = document.getElementById(id);
Â  Â  Â  Â  if(destinoDirecto) destinoDirecto.classList.remove('hidden');
Â  Â  }
}

Â  Â  Â  Â  function aprobarRiesgoBajo() {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.question-container').forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  el.classList.add('hidden');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  document.getElementById('resultado-bajo').classList.remove('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  function aprobarRiesgoMedio() {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.question-container').forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  el.classList.add('hidden');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  document.getElementById('resultado-medio').classList.remove('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  function aprobarRiesgoAlto() {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.question-container').forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  el.classList.add('hidden');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  document.getElementById('resultado-alto').classList.remove('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  function aprobarRiesgoAltoCredito() {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.question-container').forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  el.classList.add('hidden');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  document.getElementById('resultado-alto-credito').classList.remove('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  function calcularLimite() {
Â  Â  Â  Â  Â  Â  const sumaTotalSaldos = parseFloat(document.getElementById('sumaTotalSaldos').value) || 0;
Â  Â  Â  Â  Â  Â  const saldoMops = parseFloat(document.getElementById('saldoMops').value) || 0;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const limitePermitido = sumaTotalSaldos * 0.20;
Â  Â  Â  Â  Â  Â  document.getElementById('limitePermitido').textContent = '$' + limitePermitido.toLocaleString('es-MX', {minimumFractionDigits: 2});
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (sumaTotalSaldos > 0 && saldoMops >= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const resultadoDiv = document.getElementById('resultadoCalculo');
Â  Â  Â  Â  Â  Â  Â  Â  const resultadoTexto = document.getElementById('resultadoTexto');
Â  Â  Â  Â  Â  Â  Â  Â  const btnAprobar = document.getElementById('btnAprobarCalculo');
Â  Â  Â  Â  Â  Â  Â  Â  const btnContinuar = document.getElementById('btnContinuarCalculo');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  resultadoDiv.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (saldoMops <= limitePermitido) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultadoTexto.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-green-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âœ… <strong>RESULTADO:</strong> Saldo actual ($${saldoMops.toLocaleString('es-MX', {minimumFractionDigits: 2})})Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  es menor o igual al 20% permitido ($${limitePermitido.toLocaleString('es-MX', {minimumFractionDigits: 2})})
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btnAprobar.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btnContinuar.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultadoTexto.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-red-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âŒ <strong>RESULTADO:</strong> Saldo actual ($${saldoMops.toLocaleString('es-MX', {minimumFractionDigits: 2})})Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  excede el 20% permitido ($${limitePermitido.toLocaleString('es-MX', {minimumFractionDigits: 2})})
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btnAprobar.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btnContinuar.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function calcularLimiteMedio() {
Â  Â  Â  Â  Â  Â  const sumaTotalSaldos = parseFloat(document.getElementById('sumaTotalSaldosMedio').value) || 0;
Â  Â  Â  Â  Â  Â  const saldoMops = parseFloat(document.getElementById('saldoMopsMedio').value) || 0;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const limitePermitido = sumaTotalSaldos * 0.20;
Â  Â  Â  Â  Â  Â  document.getElementById('limitePermitidoMedio').textContent = '$' + limitePermitido.toLocaleString('es-MX', {minimumFractionDigits: 2});
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (sumaTotalSaldos > 0 && saldoMops >= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const resultadoDiv = document.getElementById('resultadoCalculoMedio');
Â  Â  Â  Â  Â  Â  Â  Â  const resultadoTexto = document.getElementById('resultadoTextoMedio');
Â  Â  Â  Â  Â  Â  Â  Â  const btnAprobar = document.getElementById('btnAprobarCalculoMedio');
Â  Â  Â  Â  Â  Â  Â  Â  const btnContinuar = document.getElementById('btnContinuarCalculoMedio');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  resultadoDiv.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (saldoMops <= limitePermitido) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultadoTexto.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-green-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âœ… <strong>RESULTADO:</strong> Saldo actual ($${saldoMops.toLocaleString('es-MX', {minimumFractionDigits: 2})})Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  es menor o igual al 20% permitido ($${limitePermitido.toLocaleString('es-MX', {minimumFractionDigits: 2})})
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btnAprobar.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btnContinuar.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultadoTexto.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-red-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âŒ <strong>RESULTADO:</strong> Saldo actual ($${saldoMops.toLocaleString('es-MX', {minimumFractionDigits: 2})})Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  excede el 20% permitido ($${limitePermitido.toLocaleString('es-MX', {minimumFractionDigits: 2})})
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btnAprobar.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btnContinuar.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function mostrarAlerta(mensaje) {
Â  Â  Â  Â  Â  Â  document.getElementById('textoAlerta').textContent = mensaje;
Â  Â  Â  Â  Â  Â  document.getElementById('modalAlerta').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('modalAlerta').classList.add('flex');
Â  Â  Â  Â  }

Â  Â  Â  Â  function cerrarModal() {
Â  Â  Â  Â  Â  Â  document.getElementById('modalAlerta').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('modalAlerta').classList.remove('flex');
Â  Â  Â  Â  }

       /* =========================
   SISTEMA DE REGRESAR GENERAL
========================= */

let historialPreguntas = [];
let preguntaActual = null;


/* =========================
   MOSTRAR PREGUNTA
========================= */
function mostrarPregunta(preguntaId) {

    // Ocultar todas las preguntas
    document.querySelectorAll('.question-container').forEach(el => {
        el.classList.add('hidden');
    });

    // Ocultar todos los resultados
    document.querySelectorAll('[id^="resultado-"]').forEach(el => {
        el.classList.add('hidden');
    });

    // Guardar historial si ya habÃ­a una pregunta activa
    if (preguntaActual !== null) {
        historialPreguntas.push(preguntaActual);
    }

    // Detectar si el id viene como "1-4" o "pregunta1-4"
    let elemento = document.getElementById(preguntaId) ||
                   document.getElementById('pregunta' + preguntaId);

    if (elemento) {
        elemento.classList.remove('hidden');
        preguntaActual = elemento.id;
    }

    actualizarBotonRegresar();
}


/* =========================
   REGRESAR PREGUNTA
========================= */
function regresarPregunta() {

    if (historialPreguntas.length > 0) {

        // Ocultar actual
        if (preguntaActual) {
            document.getElementById(preguntaActual).classList.add('hidden');
        }

        // Obtener la anterior
        let anterior = historialPreguntas.pop();

        document.getElementById(anterior).classList.remove('hidden');

        preguntaActual = anterior;
    }

    actualizarBotonRegresar();
}


/* =========================
   MOSTRAR / OCULTAR BOTÃ“N
========================= */
function actualizarBotonRegresar() {

    const btn = document.getElementById("btnRegresar");

    if (historialPreguntas.length > 0) {
        btn.classList.remove("hidden");
    } else {
        btn.classList.add("hidden");
    }
}
Â  Â  Â  Â  function reiniciarSistema() {
Â  Â  Â  Â  Â  Â  // Ocultar todas las preguntas excepto las de inicio
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.question-container').forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  el.classList.add('hidden');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Ocultar todos los resultados
Â  Â  Â  Â  Â  Â  document.querySelectorAll('[id^="resultado-"]').forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  el.classList.add('hidden');
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Limpiar campos de las calculadoras
Â  Â  Â  Â  Â  Â  if (document.getElementById('sumaTotalSaldos')) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('sumaTotalSaldos').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('saldoMops').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('limitePermitido').textContent = '$0.00';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('resultadoCalculo').classList.add('hidden');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (document.getElementById('sumaTotalSaldosMedio')) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('sumaTotalSaldosMedio').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('saldoMopsMedio').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('limitePermitidoMedio').textContent = '$0.00';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('resultadoCalculoMedio').classList.add('hidden');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Mostrar las preguntas de inicio de cada cuadro
Â  Â  Â  Â  Â  Â  document.getElementById('inicio-bajo').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('inicio-medio').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('inicio-alto').classList.remove('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  // Variables para el anÃ¡lisis
Â  Â  Â  Â  let politicasCumplidasGlobal = [];
Â  Â  Â  Â  let factoresRiesgoGlobal = [];

Â  Â  Â  Â  function mostrarAnalisis(tipoRiesgo) {
Â  Â  Â  Â  Â  Â  const modal = document.getElementById('modalAnalisis');
Â  Â  Â  Â  Â  Â  const iconoAnalisis = document.getElementById('iconoAnalisis');
Â  Â  Â  Â  Â  Â  const tituloAnalisis = document.getElementById('tituloAnalisis');
Â  Â  Â  Â  Â  Â  const subtituloAnalisis = document.getElementById('subtituloAnalisis');
Â  Â  Â  Â  Â  Â  const resultadoFinal = document.getElementById('resultadoFinalAnalisis');
Â  Â  Â  Â  Â  Â  const iconoResultado = document.getElementById('iconoResultado');
Â  Â  Â  Â  Â  Â  const textoResultado = document.getElementById('textoResultado');
Â  Â  Â  Â  Â  Â  const descripcionResultado = document.getElementById('descripcionResultado');
Â  Â  Â  Â  Â  Â  const politicasCumplidas = document.getElementById('politicasCumplidas');
Â  Â  Â  Â  Â  Â  const factoresRiesgo = document.getElementById('factoresRiesgo');
Â  Â  Â  Â  Â  Â  const recomendaciones = document.getElementById('recomendaciones');

Â  Â  Â  Â  Â  Â  // Configurar segÃºn el tipo de riesgo
Â  Â  Â  Â  Â  Â  let config = getAnalisisConfig(tipoRiesgo);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Actualizar elementos del modal
Â  Â  Â  Â  Â  Â  iconoAnalisis.innerHTML = `<span class="text-2xl">${config.icono}</span>`;
Â  Â  Â  Â  Â  Â  iconoAnalisis.className = `w-12 h-12 rounded-full flex items-center justify-center mr-4 ${config.bgIcono}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  tituloAnalisis.textContent = config.titulo;
Â  Â  Â  Â  Â  Â  subtituloAnalisis.textContent = config.subtitulo;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  resultadoFinal.className = `p-6 rounded-xl border-2 ${config.bgResultado} ${config.borderResultado}`;
Â  Â  Â  Â  Â  Â  iconoResultado.innerHTML = `<span class="text-lg">${config.iconoResultado}</span>`;
Â  Â  Â  Â  Â  Â  iconoResultado.className = `w-8 h-8 rounded-full flex items-center justify-center mr-3 ${config.bgIconoResultado}`;
Â  Â  Â  Â  Â  Â  textoResultado.textContent = config.textoResultado;
Â  Â  Â  Â  Â  Â  textoResultado.className = `text-lg font-bold ${config.colorTexto}`;
Â  Â  Â  Â  Â  Â  descripcionResultado.textContent = config.descripcion;

Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  modal.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  modal.classList.add('flex');
Â  Â  Â  Â  }

Â  Â  Â  Â  function getAnalisisConfig(tipoRiesgo) {
Â  Â  Â  Â  Â  Â  const configs = {
Â  Â  Â  Â  Â  Â  Â  Â  'bajo': {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icono: 'âœ…',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgIcono: 'bg-green-100',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  titulo: 'AnÃ¡lisis de Riesgo Bajo',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  subtitulo: 'Cliente aprobado con perfil crediticio excelente',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgResultado: 'bg-green-50',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderResultado: 'border-green-300',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconoResultado: 'âœ…',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgIconoResultado: 'bg-green-100',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colorTexto: 'text-green-800',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textoResultado: 'APROBADO - RIESGO BAJO',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  descripcion: 'El solicitante cumple con todos los criterios para ser considerado de riesgo bajo y es sujeto a crÃ©dito con condiciones preferenciales.',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  politicas: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Historial crediticio limpio con MOP 01-04 Ãºnicamente',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Sin cuentas morosas o problemÃ¡ticas',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Cumple con polÃ­ticas de apertura y Ãºltima compra',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Perfil crediticio estable y confiable'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  factores: [],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recomendaciones: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Ofrecer condiciones preferenciales de crÃ©dito',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Considerar lÃ­mites de crÃ©dito mÃ¡s altos',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Mantener seguimiento periÃ³dico del comportamiento crediticio',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Evaluar para productos crediticios adicionales'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  'medio': {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icono: 'âš ï¸',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgIcono: 'bg-yellow-100',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  titulo: 'AnÃ¡lisis de Riesgo Medio',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  subtitulo: 'Cliente aprobado con condiciones estÃ¡ndar',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgResultado: 'bg-yellow-50',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderResultado: 'border-yellow-300',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconoResultado: 'âš ï¸',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgIconoResultado: 'bg-yellow-100',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colorTexto: 'text-yellow-800',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textoResultado: 'APROBADO - RIESGO MEDIO',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  descripcion: 'El solicitante presenta un perfil crediticio aceptable con algunos factores de atenciÃ³n, pero es sujeto a crÃ©dito con condiciones estÃ¡ndar.',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  politicas: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Historial crediticio en la Cooperativa (si aplica)',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Sin informaciÃ³n crediticia o cuenta muy reciente',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'MOPs 05-07 dentro de lÃ­mites aceptables ($5,000)',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'CrÃ©ditos grupales con buen comportamiento de pago'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  factores: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Historial crediticio limitado o reciente',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Presencia de MOPs 05-07 en montos controlados',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Requiere monitoreo mÃ¡s frecuente'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recomendaciones: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Aplicar condiciones estÃ¡ndar de crÃ©dito',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Establecer lÃ­mites de crÃ©dito moderados',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Realizar seguimiento mensual del comportamiento',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Evaluar para incrementos despuÃ©s de 6 meses de buen pago'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  'alto-si': {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icono: 'ğŸ”',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgIcono: 'bg-orange-100',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  titulo: 'AnÃ¡lisis de Riesgo Alto - Aprobado',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  subtitulo: 'Cliente aprobado con condiciones restrictivas',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgResultado: 'bg-orange-50',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderResultado: 'border-orange-300',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconoResultado: 'âš ï¸',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgIconoResultado: 'bg-orange-100',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colorTexto: 'text-orange-800',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textoResultado: 'RIESGO ALTO - SUJETO A CRÃ‰DITO',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  descripcion: 'El solicitante presenta factores de riesgo significativos pero cumple con criterios mÃ­nimos para ser sujeto a crÃ©dito con condiciones muy restrictivas.',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  politicas: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Saldos de MOPs 05-07 dentro del 20% permitido',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Sin leyendas de fraude o ilocalizable',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Sin finiquitos, quitas o castigos',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Saldos menores a $2,000 o $7,000 segÃºn criterio',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Ãšltimo pago menor a 4 aÃ±os',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Historial de crÃ©ditos pagados de riesgo bajo/medio'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  factores: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Presencia de MOPs 05-07 significativos',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Historial crediticio con elementos problemÃ¡ticos',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Requiere evaluaciÃ³n caso por caso',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Monitoreo intensivo necesario'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recomendaciones: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Aplicar condiciones muy restrictivas',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'LÃ­mites de crÃ©dito mÃ­nimos iniciales',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Seguimiento semanal obligatorio',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Requerir garantÃ­as adicionales',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'EvaluaciÃ³n trimestral para ajustes'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  'alto-no': {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icono: 'ğŸš«',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgIcono: 'bg-red-100',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  titulo: 'AnÃ¡lisis de Riesgo Alto - Rechazado',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  subtitulo: 'Cliente no aprobado por alto riesgo crediticio',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgResultado: 'bg-red-50',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderResultado: 'border-red-300',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  iconoResultado: 'ğŸš«',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bgIconoResultado: 'bg-red-100',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colorTexto: 'text-red-800',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textoResultado: 'RIESGO ALTO - NO SUJETO A CRÃ‰DITO',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  descripcion: 'El solicitante presenta mÃºltiples factores de riesgo que impiden su aprobaciÃ³n crediticia segÃºn las polÃ­ticas institucionales.',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  politicas: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'PolÃ­tica de protecciÃ³n institucional aplicada',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Criterios de riesgo excedidos',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'ProtecciÃ³n del patrimonio de socios',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Cumplimiento normativo regulatorio'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  factores: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Leyendas de fraude, cuenta fraudulenta o ilocalizable',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Finiquitos, quitas o castigos registrados',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Saldos excesivos en cuentas morosas (+$7,000)',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Ãšltimo pago mayor a 4 aÃ±os',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Sin historial de crÃ©ditos pagados satisfactoriamente',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Concurso mercantil o quebranto'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recomendaciones: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Rechazar solicitud de crÃ©dito',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Sugerir programa de rehabilitaciÃ³n crediticia',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Reevaluar en 12-24 meses con mejoras comprobadas',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Ofrecer productos de ahorro Ãºnicamente',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Proporcionar educaciÃ³n financiera'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  return configs[tipoRiesgo] || configs['bajo'];
Â  Â  Â  Â  }

Â  Â  Â  Â  function cerrarAnalisis() {
Â  Â  Â  Â  Â  Â  document.getElementById('modalAnalisis').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('modalAnalisis').classList.remove('flex');
Â  Â  Â  Â  }

Â  Â  Â  Â  function mostrarGuiaCreditos() {
Â  Â  Â  Â  Â  Â  document.getElementById('modalGuiaCreditos').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('modalGuiaCreditos').classList.add('flex');
Â  Â  Â  Â  }

Â  Â  Â  Â  function cerrarGuiaCreditos() {
Â  Â  Â  Â  Â  Â  document.getElementById('modalGuiaCreditos').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('modalGuiaCreditos').classList.remove('flex');
Â  Â  Â  Â  }

Â  Â  Â  Â  // Cerrar modal al hacer clic fuera de Ã©l
Â  Â  Â  Â  document.getElementById('modalAlerta').addEventListener('click', function(e) {
Â  Â  Â  Â  Â  Â  if (e.target === this) {
Â  Â  Â  Â  Â  Â  Â  Â  cerrarModal();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  document.getElementById('modalAnalisis').addEventListener('click', function(e) {
Â  Â  Â  Â  Â  Â  if (e.target === this) {
Â  Â  Â  Â  Â  Â  Â  Â  cerrarAnalisis();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  document.getElementById('modalGuiaCreditos').addEventListener('click', function(e) {
Â  Â  Â  Â  Â  Â  if (e.target === this) {
Â  Â  Â  Â  Â  Â  Â  Â  cerrarGuiaCreditos();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'990108d9c1d6978c',t:'MTc2MDcxNzA5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>



<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Evaluacion de Capacidad de Pago</title>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #001f3f 0%, #003366 100%);
            padding: 20px;
            min-height: 100%;
            box-sizing: border-box;
            position: relative;
            z-index: 1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            position: relative;
            z-index: 10;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            border-bottom: 5px solid #ffd700;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.15em;
            opacity: 0.95;
            font-weight: 300;
        }

        .main-content {
            padding: 20px;
            max-width: 100%;
        }

        .section {
            background: #f8f9fa;
            border: 3px solid #e3e8ef;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .section:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            transform: translateY(-3px);
        }

        /* Grid de cuadros responsivo */
        .cuadros-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        @media (max-width: 1200px) {
            .cuadros-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .cuadros-grid {
                grid-template-columns: 1fr;
            }
        }

        .cuadro-box {
            background: #ffffff;
            border: 3px solid #e0e7ff;
            border-radius: 15px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 180px;
            transition: all 0.3s ease;
        }

        .cuadro-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .cuadro-content {
            padding: 12px;
            flex: 1;
        }

        .section-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 10px rgba(30,60,114,0.3);
        }

        .section-header h2 {
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }

        .paso-badge {
            background: rgba(255,215,0,0.25);
            color: #ffd700;
            padding: 8px 18px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 700;
            border: 2px solid rgba(255,215,0,0.4);
        }

        .form-group {
            margin-bottom: 14px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #1e3c72;
            font-size: 0.9em;
        }

        input[type="date"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #d1d9e6;
            border-radius: 8px;
            font-size: 0.95em;
            transition: all 0.3s ease;
            background: #ffffff;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #1e3c72;
            box-shadow: 0 0 0 4px rgba(30, 60, 114, 0.1);
            background: #f8f9fa;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 4px;
            box-shadow: 0 3px 5px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(30, 60, 114, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20873a 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #212529;
            font-weight: 700;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            color: white;
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            font-size: 1.05em;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-approved {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
        }

        .result-rejected {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
        }

        .result-consider {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .question-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 99999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 0;
            border-radius: 15px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content.draggable {
            cursor: move;
        }

        .modal-content.dragging {
            cursor: grabbing;
            user-select: none;
        }

        .draggable-header {
            cursor: move;
        }

        .modal-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 15px 15px 0 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .modal-header h3 {
            margin: 0 0 8px 0;
            font-weight: 700;
            font-size: 1.4em;
        }

        .modal-header p {
            margin: 0;
            opacity: 0.95;
            font-weight: 300;
        }

        .modal-body {
            padding: 30px;
        }

        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            opacity: 0.8;
        }

        .close:hover {
            opacity: 1;
        }

        .account-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .account-btn {
            padding: 22px;
            border: 3px solid #1e3c72;
            background: white;
            border-radius: 12px;
            font-size: 1.3em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #1e3c72;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }

        .account-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            transform: scale(1.08);
            box-shadow: 0 4px 12px rgba(30,60,114,0.3);
        }

        .account-btn.occupied {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            border-color: #dc3545;
            color: white;
            opacity: 0.7;
            cursor: not-allowed;
        }

        .cuenta-container {
            display: none;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border: 2px solid #3498db;
            border-radius: 8px;
        }

        .cuenta-container label {
            color: #3498db;
            font-weight: bold;
        }

        .cuenta-container.guardada-automaticamente {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 3px solid #2196f3;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        .cuenta-container.guardada-automaticamente label {
            color: #0d47a1;
            font-weight: 900;
        }

        .cuenta-container.guardada-automaticamente input {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            font-weight: bold;
            color: #0d47a1;
        }

        .cuenta-subtitulo-automatica {
            font-size: 0.7em;
            color: #1976d2;
            font-weight: 600;
            font-style: italic;
            margin-top: 2px;
            display: block;
        }

        .sin-cuentas {
            text-align: center;
            padding: 40px;
            color: #95a5a6;
            font-style: italic;
        }

        .counter-badge {
            background: linear-gradient(135deg, #28a745 0%, #20873a 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 700;
            display: inline-block;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(40,167,69,0.3);
            font-size: 1.1em;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @media (max-width: 768px) {
            .account-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .question-buttons {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .main-content {
                padding: 15px;
            }

            .cuadro-content {
                padding: 12px;
            }
        }

        .info-box {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .step-divider {
            border-top: 3px dashed #95a5a6;
            margin: 40px 0;
        }

        .btn-eliminar-cuenta {
            background: #ffffff;
            color: #000000;
            border: 1px solid #ddd;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            padding: 0;
            line-height: 1;
        }

        .btn-eliminar-cuenta:hover {
            background: #f0f0f0;
            border-color: #999;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
    </style>
  <script src="https://cdn.tailwindcss.com/3.4.17" type="text/javascript"></script>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <header class="header">
    <h1>Sistema de Capacidad de Pago</h1>
   </header>
   <main class="main-content"><!-- PASO 1 -->
    <div class="section">
     <div class="section-header">
      <h2>PASO 1: Evaluacion de Cuentas Crediticias</h2><span class="paso-badge">Paso 1 de 2</span>
     </div>
     <div class="info-box"><strong>Instrucciones:</strong> Evalue cada tipo de cuenta segun los criterios establecidos. Puede registrar multiples cuentas y continuar registrando hasta tener todas las cuentas evaluadas. Una vez que tenga todas las cuentas registradas, puede proceder al Paso 2 para usar las calculadoras.
     </div>
     <div class="cuadros-grid"><!-- CUADRO 1 -->
      <div class="cuadro-box">
       <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); padding: 15px 18px; box-shadow: 0 4px 6px rgba(30, 60, 114, 0.3);">
        <h3 style="color: #ffffff; margin: 0; font-weight: 900; font-size: 1.3em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); letter-spacing: 0.5px;">1ï¸âƒ£ Cuentas MOP 01 Y 02</h3>
       </div>
       <div class="cuadro-content">
        <p style="color: #4a5568; margin-bottom: 12px; background: #e6f2ff; padding: 10px; border-radius: 8px; border-left: 4px solid #3182ce; font-size: 0.85em;"><strong style="color: #2c5282;">Criterio:</strong> Socios nuevos y de renovaciÃ³n<br><small>Fecha de consulta menor a (fecha de apertura + plazo en meses + 1 mes)</small></p>
        <div class="form-group"><label for="fechaConsulta1">Fecha de Consulta:</label> <input type="date" id="fechaConsulta1">
        </div>
        <div class="form-group"><label for="fechaApertura1">Fecha de Apertura:</label> <input type="date" id="fechaApertura1">
        </div>
        <div class="form-group"><label for="plazoMeses1">Plazo en Meses:</label> <input type="number" id="plazoMeses1" placeholder="Ej: 24">
        </div>
        <div class="button-group"><button class="btn btn-primary" onclick="evaluarCuadro1()">Evaluar Cuenta</button> <button class="btn btn-secondary" onclick="resetearCuadro1()">Limpiar</button>
        </div>
        <div id="resultado1"></div>
       </div>
      </div><!-- CUADRO 2 -->
      <div class="cuadro-box">
       <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); padding: 15px 18px; box-shadow: 0 4px 6px rgba(30, 60, 114, 0.3);">
        <h3 style="color: #ffffff; margin: 0; font-weight: 900; font-size: 1.3em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); letter-spacing: 0.5px;">2ï¸âƒ£ Cuentas MOP 01-04</h3>
       </div>
       <div class="cuadro-content">
        <p style="color: #4a5568; margin-bottom: 12px; background: #e6f2ff; padding: 10px; border-radius: 8px; border-left: 4px solid #3182ce; font-size: 0.85em;"><strong style="color: #2c5282;">Aplica:</strong> Socios nuevos y de renovaciÃ³n</p>
        <p style="font-weight: 600; margin-bottom: 10px;">Â¿La cuenta tiene fecha de cierre en la columna "CIERRE"?</p>
        <div class="question-buttons"><button class="btn btn-success" onclick="evaluarCuadro2('si')">SÃ</button> <button class="btn btn-danger" onclick="evaluarCuadro2('no')">NO</button>
        </div>
        <div class="button-group" style="margin-top: 15px;"><button class="btn btn-secondary" onclick="resetearCuadro2()">Limpiar</button>
        </div>
        <div id="resultado2"></div>
       </div>
      </div><!-- CUADRO 3 -->
      <div class="cuadro-box">
       <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); padding: 15px 18px; box-shadow: 0 4px 6px rgba(30, 60, 114, 0.3);">
        <h3 style="color: #ffffff; margin: 0; font-weight: 900; font-size: 1.3em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); letter-spacing: 0.5px;">3ï¸âƒ£ Cuentas MOP 05 o mas</h3>
       </div>
       <div class="cuadro-content">
        <p style="color: #4a5568; margin-bottom: 12px; background: #e6f2ff; padding: 10px; border-radius: 8px; border-left: 4px solid #3182ce; font-size: 0.85em;"><strong style="color: #2c5282;">Aplica:</strong> Socios nuevos</p>
        <p style="font-weight: 600; margin-bottom: 10px;">En la columna "ULTIMO PAGO" Â¿La fecha es mayor a 4 aÃ±os?</p>
        <div class="question-buttons"><button class="btn btn-success" onclick="evaluarCuadro3('si')">SÃ</button> <button class="btn btn-danger" onclick="evaluarCuadro3('no')">NO (Menor a 4 aÃ±os)</button>
        </div>
        <div class="button-group" style="margin-top: 15px;"><button class="btn btn-secondary" onclick="resetearCuadro3()">Limpiar</button>
        </div>
        <div id="resultado3"></div>
       </div>
      </div><!-- CUADRO 4 -->
      <div class="cuadro-box">
       <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); padding: 15px 18px; box-shadow: 0 4px 6px rgba(30, 60, 114, 0.3);">
        <h3 style="color: #ffffff; margin: 0; font-weight: 900; font-size: 1.3em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); letter-spacing: 0.5px;">4ï¸âƒ£ Cuentas MOP 05 o mÃ¡s</h3>
       </div>
       <div class="cuadro-content">
        <p style="color: #4a5568; margin-bottom: 12px; background: #e6f2ff; padding: 10px; border-radius: 8px; border-left: 4px solid #3182ce; font-size: 0.85em;"><strong style="color: #2c5282;">Aplica:</strong> Socios con historial en Acreimex</p>
        <p style="font-weight: 600; margin-bottom: 10px;">En la columna "ULTIMO PAGO" Â¿La fecha es mayor a 1 aÃ±o?</p>
        <div class="question-buttons"><button class="btn btn-success" onclick="evaluarCuadro4Mayor1Ano('si')">SÃ</button> <button class="btn btn-danger" onclick="mostrarCalculadora4()">NO (Menor a 1 aÃ±o)</button>
        </div>
        <div id="calculadora4" style="display: none; margin-top: 20px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
         <h4 style="color: #f39c12; margin-bottom: 15px;">Ingresar Monto a Pagar</h4>
         <p style="margin-bottom: 15px; color: #666;">Ingrese el monto que desea considerar para esta cuenta</p>
         <div class="form-group"><label for="montoPagar4">Monto a Pagar ($):</label> <input type="number" id="montoPagar4" placeholder="Ej: 800" step="0.01">
         </div>
         <div class="button-group"><button class="btn btn-success" onclick="guardarMontoCuadro4()">Guardar Automaticamente</button> <button class="btn btn-secondary" onclick="resetearCuadro4()">Cancelar</button>
         </div>
        </div>
        <div class="button-group" style="margin-top: 15px;"><button class="btn btn-secondary" onclick="resetearCuadro4()">Limpiar Todo</button>
        </div>
        <div id="resultado4"></div>
       </div>
      </div><!-- CUADRO 5 -->
      <div class="cuadro-box">
       <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); padding: 15px 18px; box-shadow: 0 4px 6px rgba(30, 60, 114, 0.3);">
        <h3 style="color: #ffffff; margin: 0; font-weight: 900; font-size: 1.3em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); letter-spacing: 0.5px;">5ï¸âƒ£ Tarjetas de Credito</h3>
       </div>
       <div class="cuadro-content">
        <p style="color: #4a5568; margin-bottom: 12px; background: #e6f2ff; padding: 10px; border-radius: 8px; border-left: 4px solid #3182ce; font-size: 0.85em;"><strong style="color: #2c5282;">Criterio:</strong> Tarjetas de crÃ©dito, servicios, telecomunicaciones, gubernamentales</p>
        <p style="font-weight: 600; margin-bottom: 10px;">En la columna "SALDO ACTUAL" Â¿Tiene un monto menor a $8,000.00?</p>
        <div class="question-buttons"><button class="btn btn-success" onclick="evaluarCuadro5('si')">SI (Menor a $8,000)</button> <button class="btn btn-danger" onclick="evaluarCuadro5('no')">NO (Mayor a $8,000)</button>
        </div>
        <div class="button-group" style="margin-top: 15px;"><button class="btn btn-secondary" onclick="resetearCuadro5()">Limpiar</button>
        </div>
        <div id="resultado5"></div>
       </div>
      </div><!-- CUADRO 6 -->
      <div class="cuadro-box">
       <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); padding: 15px 18px; box-shadow: 0 4px 6px rgba(30, 60, 114, 0.3);">
        <h3 style="color: #ffffff; margin: 0; font-weight: 900; font-size: 1.3em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); letter-spacing: 0.5px;">6ï¸âƒ£ Creditos Revolventes</h3>
       </div>
       <div class="cuadro-content">
        <p style="color: #4a5568; margin-bottom: 12px; background: #e6f2ff; padding: 10px; border-radius: 8px; border-left: 4px solid #3182ce; font-size: 0.85em;"><strong style="color: #2c5282;">Criterio:</strong> Tarjetas de crÃ©dito, lÃ­neas de crÃ©dito o crÃ©dito revolventes</p><!-- PREGUNTA ÃšNICA -->
        <p style="font-weight: 600; margin-bottom: 10px;">Revisa las columnas "FECHA DE APERTURA" y "ULTIMA COMPRA" Â¿Corresponden a la misma fecha?</p>
        <div class="question-buttons"><button class="btn btn-success" onclick="rechazarCuadro6PreguntaUnica()">SÃ</button> <button class="btn btn-danger" onclick="mostrarCalculadoraLimiteUnica()">NO</button>
        </div>
        <div id="resultado6a" style="margin-top: 10px;"></div><!-- CALCULADORA DE LÃMITE DE CRï¿½ï¿½DITO -->
        <div id="calculadoraLimiteUnica" style="display: none; background: #e6f7ed; border: 3px solid #27ae60; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
         <h4 style="color: #27ae60; margin: 0 0 12px 0; font-size: 1.05em; font-weight: 700;">ğŸ§® Calculadora: CrÃ©ditos Revolventes</h4>
         <div class="form-group"><label for="pagoMinimoUnica">Monto a Pagar ($):</label> <input type="number" id="pagoMinimoUnica" placeholder="Ej: 500" step="0.01" oninput="verificarMontoPagarUnica()">
         </div>
         <div class="form-group" id="campoLimiteCreditoUnica" style="display: none;"><label for="saldoActualUnica">LÃ­mite de CrÃ©dito ($):</label> <input type="number" id="saldoActualUnica" placeholder="Ej: 50000" step="0.01">
         </div>
         <div class="button-group"><button class="btn btn-primary" onclick="calcularLimiteCreditoUnica()">Calcular</button>
         </div>
        </div>
        <div class="button-group" style="margin-top: 15px;"><button class="btn btn-secondary" onclick="resetearCuadro6()">Limpiar</button>
        </div>
        <div id="resultado6"></div>
       </div>
      </div><!-- CUADRO 7 -->
      <div class="cuadro-box">
       <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); padding: 15px 18px; box-shadow: 0 4px 6px rgba(30, 60, 114, 0.3);">
        <h3 style="color: #ffffff; margin: 0; font-weight: 900; font-size: 1.3em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); letter-spacing: 0.5px;">7ï¸âƒ£ Cuentas Duplicadas y Renovacion</h3>
       </div>
       <div class="cuadro-content">
        <div style="background: #fff3cd; border-left: 4px solid #f39c12; padding: 15px; margin: 15px 0; border-radius: 5px;">
         <p style="margin: 8px 0; color: #856404;"><strong>Revisa las columnas:</strong></p>
         <ul style="margin: 10px 0; padding-left: 20px; color: #856404;">
          <li>"TIPO DE CREDITO"</li>
          <li>"CUENTA"</li>
          <li>"RESPONSABILIDAD"</li>
          <li>"APERTURA"</li>
          <li>"CREDITO MAX."</li>
          <li>"SALDO ACTUAL"</li>
         </ul>
         <p style="margin: 8px 0; color: #856404;"><strong>Solo considera UNA cuenta</strong> si coinciden estos datos</p>
         <p style="margin: 8px 0; color: #856404;"><strong>NO considerar</strong> las cuentas de <strong>ACREIMEX</strong> que el socio vaya a renovar o liquidar</p>
        </div>
        <div class="warning-box"><strong>ACCION REQUERIDA:</strong> Revisar manualmente las cuentas duplicadas y excluir renovaciones de ACREIMEX
        </div>
       </div>
      </div>
     </div>
    </div>
    <div class="step-divider"></div><!-- PASO 2 Y 3 COMBINADO -->
    <div class="section">
     <div class="section-header" style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%);">
      <h2>PASO 2: Calculadora, Resumen y Calculo Final</h2><span class="paso-badge">Paso 2 de 2</span>
     </div>
     <div class="info-box"><strong>Instrucciones:</strong> Use la calculadora para asignar montos a las cuentas registradas del Paso 1, revise todas las cuentas, ajuste montos si es necesario, y calcule la capacidad de pago total.
     </div>
     <div class="cuadros-grid" style="grid-template-columns: repeat(2, 1fr);"><!-- CUADRO 8 -->
      <div class="cuadro-box">
       <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); padding: 15px 18px; box-shadow: 0 4px 6px rgba(30, 60, 114, 0.3);">
        <h3 style="color: #ffffff; margin: 0; font-weight: 900; font-size: 1.3em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); letter-spacing: 0.5px;">ğŸ§® Calculadora</h3>
       </div>
       <div class="cuadro-content">
        <div class="form-group"><label for="saldoActual8">Saldo Actual de la Cuenta:</label> <input type="number" id="saldoActual8" placeholder="Ej: 50000" step="0.01">
        </div>
        <div class="form-group"><label for="monto8">Monto (columna monto a pagar):</label> <input type="number" id="monto8" placeholder="Ej: 2500" step="0.01">
        </div>
        <div class="form-group"><label for="plazo8">Periodicidad:</label> <select id="plazo8"> <option value="">Seleccione periodicidad</option> <option value="diario">DIARIO</option> <option value="semanal">SEMANAL</option> <option value="catorcenal">CATORCENAL</option> <option value="quincenal">QUINCENAL</option> <option value="mensual">MENSUAL</option> <option value="pago_minimo">PAGO MINIMO</option> <option value="variable">VARIABLE</option> <option value="bimestral">BIMESTRAL</option> <option value="trimestral">TRIMESTRAL</option> <option value="semestral">SEMESTRAL</option> <option value="anual">ANUAL</option> </select>
        </div>
        <div class="button-group" style="margin-bottom: 10px;"><button class="btn btn-primary" onclick="calcularCapacidadPago()">Calcular</button> <button class="btn btn-secondary" onclick="resetearCuadro8()">Limpiar</button>
        </div>
        <div class="button-group"><button class="btn btn-success" id="btnGuardar8" style="display: none;" onclick="validarYGuardar()">Conectar con Cuenta del Paso 1</button>
        </div>
        <div id="resultado8"></div>
        <div id="detalleCalculo8"></div>
       </div>
      </div><!-- CUADRO 9 - Resumen y Total -->
      <div class="cuadro-box">
       <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); padding: 15px 18px; box-shadow: 0 4px 6px rgba(30, 60, 114, 0.3);">
        <h3 style="color: #ffffff; margin: 0; font-weight: 900; font-size: 1.3em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); letter-spacing: 0.5px;">ğŸ“Š Cuentas Registradas y Total</h3>
       </div>
       <div class="cuadro-content">
        <div class="counter-badge">
         Cuentas Registradas: <span id="numCuentas">0</span> / 50
        </div>
        <div id="sinCuentas" class="sin-cuentas">
         <h3>Sin Cuentas Registradas</h3>
         <p>Complete la evaluacion en el Paso 1 y registre las cuentas que apliquen</p>
        </div><!-- Contenedores para las 50 cuentas -->
        <div id="cuenta1-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta1" style="margin: 0;">Cuenta 1:</label> <button onclick="eliminarCuenta(1)" class="btn-eliminar-cuenta" title="Eliminar cuenta">ï¿½ï¿½</button>
         </div><input type="number" id="cuenta1" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta2-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta2" style="margin: 0;">Cuenta 2:</label> <button onclick="eliminarCuenta(2)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta2" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta3-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta3" style="margin: 0;">Cuenta 3:</label> <button onclick="eliminarCuenta(3)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta3" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta4-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta4" style="margin: 0;">Cuenta 4:</label> <button onclick="eliminarCuenta(4)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta4" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta5-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta5" style="margin: 0;">Cuenta 5:</label> <button onclick="eliminarCuenta(5)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta5" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta6-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta6" style="margin: 0;">Cuenta 6:</label> <button onclick="eliminarCuenta(6)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta6" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta7-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta7" style="margin: 0;">Cuenta 7:</label> <button onclick="eliminarCuenta(7)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta7" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta8-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta8" style="margin: 0;">Cuenta 8:</label> <button onclick="eliminarCuenta(8)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta8" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta9-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta9" style="margin: 0;">Cuenta 9:</label> <button onclick="eliminarCuenta(9)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta9" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta10-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta10" style="margin: 0;">Cuenta 10:</label> <button onclick="eliminarCuenta(10)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta10" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta11-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta11" style="margin: 0;">Cuenta 11:</label> <button onclick="eliminarCuenta(11)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta11" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta12-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta12" style="margin: 0;">Cuenta 12:</label> <button onclick="eliminarCuenta(12)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta12" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta13-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta13" style="margin: 0;">Cuenta 13:</label> <button onclick="eliminarCuenta(13)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta13" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta14-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta14" style="margin: 0;">Cuenta 14:</label> <button onclick="eliminarCuenta(14)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta14" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta15-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta15" style="margin: 0;">Cuenta 15:</label> <button onclick="eliminarCuenta(15)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta15" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta16-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta16" style="margin: 0;">Cuenta 16:</label> <button onclick="eliminarCuenta(16)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta16" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta17-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta17" style="margin: 0;">Cuenta 17:</label> <button onclick="eliminarCuenta(17)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta17" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta18-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta18" style="margin: 0;">Cuenta 18:</label> <button onclick="eliminarCuenta(18)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta18" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta19-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta19" style="margin: 0;">Cuenta 19:</label> <button onclick="eliminarCuenta(19)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta19" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta20-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta20" style="margin: 0;">Cuenta 20:</label> <button onclick="eliminarCuenta(20)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta20" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta21-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta21" style="margin: 0;">Cuenta 21:</label> <button onclick="eliminarCuenta(21)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta21" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta22-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta22" style="margin: 0;">Cuenta 22:</label> <button onclick="eliminarCuenta(22)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta22" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta23-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta23" style="margin: 0;">Cuenta 23:</label> <button onclick="eliminarCuenta(23)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta23" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta24-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta24" style="margin: 0;">Cuenta 24:</label> <button onclick="eliminarCuenta(24)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta24" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta25-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta25" style="margin: 0;">Cuenta 25:</label> <button onclick="eliminarCuenta(25)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta25" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta26-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta26" style="margin: 0;">Cuenta 26:</label> <button onclick="eliminarCuenta(26)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta26" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta27-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta27" style="margin: 0;">Cuenta 27:</label> <button onclick="eliminarCuenta(27)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta27" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta28-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta28" style="margin: 0;">Cuenta 28:</label> <button onclick="eliminarCuenta(28)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta28" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta29-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta29" style="margin: 0;">Cuenta 29:</label> <button onclick="eliminarCuenta(29)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta29" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta30-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta30" style="margin: 0;">Cuenta 30:</label> <button onclick="eliminarCuenta(30)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta30" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta31-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta31" style="margin: 0;">Cuenta 31:</label> <button onclick="eliminarCuenta(31)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta31" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta32-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta32" style="margin: 0;">Cuenta 32:</label> <button onclick="eliminarCuenta(32)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta32" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta33-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta33" style="margin: 0;">Cuenta 33:</label> <button onclick="eliminarCuenta(33)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta33" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta34-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta34" style="margin: 0;">Cuenta 34:</label> <button onclick="eliminarCuenta(34)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta34" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta35-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta35" style="margin: 0;">Cuenta 35:</label> <button onclick="eliminarCuenta(35)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta35" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta36-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta36" style="margin: 0;">Cuenta 36:</label> <button onclick="eliminarCuenta(36)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta36" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta37-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta37" style="margin: 0;">Cuenta 37:</label> <button onclick="eliminarCuenta(37)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta37" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta38-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta38" style="margin: 0;">Cuenta 38:</label> <button onclick="eliminarCuenta(38)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta38" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta39-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta39" style="margin: 0;">Cuenta 39:</label> <button onclick="eliminarCuenta(39)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta39" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta40-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta40" style="margin: 0;">Cuenta 40:</label> <button onclick="eliminarCuenta(40)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta40" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta41-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta41" style="margin: 0;">Cuenta 41:</label> <button onclick="eliminarCuenta(41)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta41" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta42-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta42" style="margin: 0;">Cuenta 42:</label> <button onclick="eliminarCuenta(42)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta42" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta43-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta43" style="margin: 0;">Cuenta 43:</label> <button onclick="eliminarCuenta(43)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta43" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta44-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta44" style="margin: 0;">Cuenta 44:</label> <button onclick="eliminarCuenta(44)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta44" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta45-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta45" style="margin: 0;">Cuenta 45:</label> <button onclick="eliminarCuenta(45)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta45" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta46-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta46" style="margin: 0;">Cuenta 46:</label> <button onclick="eliminarCuenta(46)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta46" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta47-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta47" style="margin: 0;">Cuenta 47:</label> <button onclick="eliminarCuenta(47)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta47" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta48-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta48" style="margin: 0;">Cuenta 48:</label> <button onclick="eliminarCuenta(48)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta48" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta49-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta49" style="margin: 0;">Cuenta 49:</label> <button onclick="eliminarCuenta(49)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta49" placeholder="Monto" step="0.01">
        </div>
        <div id="cuenta50-container" class="cuenta-container">
         <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"><label for="cuenta50" style="margin: 0;">Cuenta 50:</label> <button onclick="eliminarCuenta(50)" class="btn-eliminar-cuenta" title="Eliminar cuenta">âœ•</button>
         </div><input type="number" id="cuenta50" placeholder="Monto" step="0.01">
        </div>
        <div class="button-group" style="margin-top: 20px;"><button class="btn btn-success" onclick="sumarTotal()">Calcular Capacidad de Pago Total</button> <button class="btn btn-warning" id="btnFicha" style="display: none;" onclick="generarFichaCapacidad()">Ver Ficha Completa</button> <button class="btn btn-danger" onclick="resetearCuadro9()">Limpiar Todo</button>
        </div>
        <div id="resultado9"></div>
       </div>
      </div>
     </div>
    </div>
   </main>
  </div><!-- Modal para Registrar Cuenta -->
  <div id="modalRegistrarCuenta" class="modal">
   <div class="modal-content">
    <div class="modal-header"><span class="close" onclick="cerrarModal()">Ã—</span>
     <h3>REGISTRAR CUENTA</h3>
     <p>Seleccione el numero de cuenta para registrar</p>
    </div>
    <div class="modal-body">
     <div id="accountGrid" class="account-grid"></div>
    </div>
   </div>
  </div><!-- Modal para Ficha de Capacidad -->
  <div id="modalFichaCapacidad" class="modal">
   <div class="modal-content">
    <div class="modal-header draggable-header"><span class="close" onclick="cerrarModalFicha()">Ã—</span>
     <h3>FICHA DE CAPACIDAD DE PAGO</h3>
     <p>Resumen completo de evaluacion crediticia</p>
    </div>
    <div class="modal-body">
     <div id="fichaContent"></div>
     <div class="button-group" style="margin-top: 20px;"><button class="btn btn-primary" onclick="imprimirFicha()">Imprimir Ficha</button> <button class="btn btn-secondary" onclick="cerrarModalFicha()">Cerrar</button>
     </div>
    </div>
   </div>
  </div><!-- Modal de Bienvenida -->
  <div id="modalBienvenida" class="modal" style="display: block;">
   <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header" style="background: linear-gradient(135deg, #001f3f 0%, #003366 100%);">
     <h3 style="font-size: 1.8em; text-align: center; margin-bottom: 8px;">BIENVENIDO AL SISTEMA DE EVALUACION</h3>
     <p style="text-align: center; font-size: 1.1em; margin: 0; opacity: 0.95;">GuÃ­a completa para usar la herramienta correctamente</p>
    </div>
    <div class="modal-body" style="font-size: 0.95em;"><!-- SECCIÃ“N SUJETO A CREDITO -->
     <div style="background: #e8f4f8; border: 3px solid #3498db; padding: 25px; margin-bottom: 25px; border-radius: 12px;">
      <h3 style="color: #2c5282; margin: 0 0 20px 0; font-size: 1.4em; text-align: center;">ğŸ“‹ GuÃ­a: Sujeto a CrÃ©dito (AnÃ¡lisis RÃ¡pido)</h3>
      <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 15px; border-left: 5px solid #3498db;">
       <h4 style="color: #2c5282; margin: 0 0 12px 0; font-size: 1.15em;">Â¿CÃ³mo usarlo?</h4>
       <p style="margin: 8px 0; line-height: 1.7;"><strong style="color: #27ae60;">âœ“ EvaluaciÃ³n RÃ¡pida</strong></p>
       <p style="margin: 8px 0 8px 20px; line-height: 1.7;">Haz clic en <strong>"Iniciar EvaluaciÃ³n"</strong>. Lee la pregunta y presiona <strong>"SÃ­"</strong> o <strong>"No"</strong>. El sistema te guiarÃ¡ automÃ¡ticamente: Si la respuesta cambia el riesgo, la herramienta te moverÃ¡ sola al siguiente panel.</p>
      </div>
      <div style="background: white; padding: 20px; border-radius: 8px; border-left: 5px solid #f39c12;">
       <h4 style="color: #856404; margin: 0 0 12px 0; font-size: 1.15em;">âš¡ Resultado</h4>
       <p style="margin: 8px 0; line-height: 1.7;">Al terminar, verÃ¡s un cuadro final: <strong style="color: #27ae60;">"Sujeto a CrÃ©dito"</strong> (Aprobado) o <strong style="color: #dc3545;">"No Sujeto"</strong> (Rechazado). Presiona <strong>"ğŸ”„ Reiniciar AnÃ¡lisis"</strong> para limpiar todo y evaluar los siguientes, o usa <strong>"ğŸ”™ Pregunta Anterior"</strong> para volver a la pregunta anterior.</p>
       <p style="margin: 12px 0 0 0; padding: 12px; background: #fff3cd; border-radius: 6px; line-height: 1.7;"><strong>BotÃ³n "GuÃ­a CrÃ©ditos Grupales":</strong> Ãšsalo si tienes dudas para identificar si un crÃ©dito es grupal</p>
      </div>
     </div><!-- SECCIÃ“N CAPACIDAD DE PAGO -->
     <div style="background: #d4edda; border: 3px solid #27ae60; padding: 25px; margin-bottom: 25px; border-radius: 12px;">
      <h3 style="color: #155724; margin: 0 0 20px 0; font-size: 1.4em; text-align: center;">GuÃ­a Detallada: Capacidad de Pago (CÃ¡lculo de Montos)</h3><!-- PASO 1 -->
      <div style="background: white; padding: 18px; margin-bottom: 15px; border-radius: 8px; border-left: 5px solid #3498db;">
       <h4 style="color: #2c5282; margin: 0 0 10px 0; font-size: 1.1em;"><span style="background: #3498db; color: white; padding: 4px 12px; border-radius: 15px; margin-right: 8px; font-size: 0.9em;">1</span> Evaluar y Registrar Cuentas</h4>
       <ul style="margin: 8px 0; padding-left: 40px; line-height: 1.7;">
        <li>Complete los datos en cada cuadro segÃºn el tipo de cuenta</li>
        <li>Si es <strong style="color: #27ae60;">APROBADA</strong> â†’ <strong style="color: #f39c12;">REGISTRE</strong> la cuenta (seleccione un nÃºmero del 1 al 50)</li>
        <li>Algunos cuadros guardan el monto automÃ¡ticamente</li>
       </ul>
      </div><!-- PASO 2 -->
      <div style="background: white; padding: 18px; margin-bottom: 15px; border-radius: 8px; border-left: 5px solid #f39c12;">
       <h4 style="color: #856404; margin: 0 0 10px 0; font-size: 1.1em;"><span style="background: #f39c12; color: white; padding: 4px 12px; border-radius: 15px; margin-right: 8px; font-size: 0.9em;">2</span> Usar la Calculadora</h4>
       <ul style="margin: 8px 0; padding-left: 40px; line-height: 1.7;">
        <li>Ingrese: <strong>Saldo Actual + Monto + Periodicidad</strong></li>
        <li>Click en <strong>"Calcular"</strong> y luego <strong>"Conectar con Cuenta del Paso 1"</strong></li>
        <li>Seleccione una cuenta ya registrada para asignarle el monto</li>
       </ul>
      </div><!-- PASO 3 -->
      <div style="background: white; padding: 18px; margin-bottom: 15px; border-radius: 8px; border-left: 5px solid #27ae60;">
       <h4 style="color: #155724; margin: 0 0 10px 0; font-size: 1.1em;"><span style="background: #27ae60; color: white; padding: 4px 12px; border-radius: 15px; margin-right: 8px; font-size: 0.9em;">3</span> Calcular Total y Ver Ficha</h4>
       <ul style="margin: 8px 0; padding-left: 40px; line-height: 1.7;">
        <li>Revise los montos registrados en el Cuadro 9</li>
        <li>Use la <strong>X pequeÃ±a</strong> junto a cada cuenta para eliminarla si es necesario</li>
        <li>Ajuste montos manualmente si lo requiere</li>
        <li>Click en <strong>"Calcular Capacidad de Pago Total"</strong></li>
        <li>Click en <strong>"Ver Ficha Completa"</strong> para generar el informe y descargarlo</li>
       </ul>
      </div><!-- PASO 4 -->
      <div style="background: white; padding: 18px; margin-bottom: 15px; border-radius: 8px; border-left: 5px solid #5a6268;">
       <h4 style="color: #2c3e50; margin: 0 0 10px 0; font-size: 1.1em;"><span style="background: #5a6268; color: white; padding: 4px 12px; border-radius: 15px; margin-right: 8px; font-size: 0.9em;">4</span> Imprimir Ficha Completa</h4>
       <ul style="margin: 8px 0; padding-left: 40px; line-height: 1.7;">
        <li>Una vez calculado el total, presione <strong>"Ver Ficha Completa"</strong></li>
        <li>La ficha muestra todas las cuentas evaluadas con sus montos y criterios</li>
        <li>Puede imprimir o guardar la ficha para sus registros</li>
       </ul>
      </div>
     </div><!-- TIPS CLAVE -->
     <div style="background: #fff3cd; border: 3px solid #f39c12; padding: 20px; margin-bottom: 25px; border-radius: 12px;">
      <h3 style="color: #856404; margin: 0 0 15px 0; font-size: 1.2em; text-align: center;">ğŸ’¡ Tips Clave del Sistema:</h3>
      <ul style="margin: 10px 0; padding-left: 25px; line-height: 1.8; color: #856404;">
       <li><strong>Ajustes manuales:</strong> Puede modificar cualquier monto directamente en el Cuadro 9 antes de calcular el total</li>
       <li><strong>Eliminar cuentas:</strong> Use la X pequeÃ±a junto a cada cuenta. Las del Cuadro 4 y 6 se eliminan completamente, las demÃ¡s solo pierden el monto pero quedan disponibles</li>
       <li><strong>Cuentas guardadas automÃ¡ticamente:</strong> Las cuentas de los Cuadros 4 y 6 aparecen con fondo azul claro y bordes azules gruesos en el Cuadro 9, indicando que fueron guardadas automÃ¡ticamente con su monto calculado</li>
       <li><strong>FunciÃ³n de distinguir cuentas:</strong> Para identificar visualmente las cuentas guardadas automÃ¡ticamente en la calculadora, busque el fondo azul claro con bordes azules gruesos en las cuentas del Cuadro 9. Esto le ayuda a saber cuÃ¡les montos ya estan completos</li>
       <li><strong>Cuadro 7:</strong> Es puramente informativo para recordarle revisar duplicados manualmente. No calcula ni guarda montos automÃ¡ticamente</li>
       <li><strong>Ficha final:</strong> Muestra todas las cuentas con monto, su justificaciÃ³n, criterios aplicados y el total calculado para imprimir</li>
      </ul>
     </div><!-- BOTÃ“N COMENZAR -->
     <div style="text-align: center; margin-top: 30px;"><button class="btn btn-success" onclick="cerrarBienvenida()" style="font-size: 1.3em; padding: 18px 50px; animation: pulse 2s infinite; box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);"> âœ… Entendido, Comenzar EvaluaciÃ³n </button>
     </div>
    </div>
   </div>
  </div>
  <script>
        // Variables globales
        let cuentasGuardadas = 0;
        let montoCalculado8 = 0;
        let cuentasOcupadas = new Set();
        let cuadroActual = 0;
        let totalCapacidadPago = 0;
        let cuentasRegistradas = {};

        // FunciÃ³n para cerrar modal de bienvenida
        function cerrarBienvenida() {
            document.getElementById('modalBienvenida').style.display = 'none';
        }



        // Funciones de evaluaciÃ³n CUADRO 1
        function evaluarCuadro1() {
            const fechaConsulta = new Date(document.getElementById('fechaConsulta1').value);
            const fechaApertura = new Date(document.getElementById('fechaApertura1').value);
            const plazoMeses = parseInt(document.getElementById('plazoMeses1').value);

            if (!fechaConsulta || !fechaApertura || !plazoMeses) {
                document.getElementById('resultado1').innerHTML = '<div class="result result-rejected">Por favor complete todos los campos</div>';
                return;
            }

            const fechaLimite = new Date(fechaApertura);
            fechaLimite.setMonth(fechaLimite.getMonth() + plazoMeses + 1);

            let resultado;
            if (fechaConsulta < fechaLimite) {
                resultado = `
                    <div class="result result-approved">
                        <strong>RESULTADO:</strong> CUENTA APROBADA<br>
                        <strong>Fecha Consulta:</strong> ${fechaConsulta.toLocaleDateString('es-MX')}<br>
                        <strong>Fecha LÃ­mite:</strong> ${fechaLimite.toLocaleDateString('es-MX')}<br>
                        <small>${fechaConsulta.toLocaleDateString('es-MX')} < ${fechaLimite.toLocaleDateString('es-MX')}</small>
                        <div style="background: #fff3cd; border: 2px solid #f39c12; border-radius: 8px; padding: 15px; margin: 15px 0; text-align: center;">
                            <strong style="color: #856404;">ACCION OBLIGATORIA</strong><br>
                            <span style="color: #856404;">Debe registrar esta cuenta para continuar</span><br>
                            <button class="btn btn-success" onclick="abrirModalRegistro(1)" style="margin-top: 10px; animation: pulse 2s infinite;">REGISTRAR CUENTA OBLIGATORIO</button>
                        </div>
                    </div>
                `;
            } else {
                resultado = `
                    <div class="result result-rejected">
                        <strong>RESULTADO:</strong> CUENTA RECHAZADA<br>
                        <strong>Fecha Consulta:</strong> ${fechaConsulta.toLocaleDateString('es-MX')}<br>
                        <strong>Fecha LÃ­mite:</strong> ${fechaLimite.toLocaleDateString('es-MX')}<br>
                        <small>${fechaConsulta.toLocaleDateString('es-MX')} >= ${fechaLimite.toLocaleDateString('es-MX')}</small>
                    </div>
                `;
            }

            document.getElementById('resultado1').innerHTML = resultado;
        }

        // Funciones de evaluaciÃ³n CUADRO 2
        function evaluarCuadro2(respuesta) {
            let resultado;
            if (respuesta === 'si') {
                resultado = '<div class="result result-rejected"><strong>RESULTADO:</strong> CUENTA RECHAZADA - Tiene fecha de cierre</div>';
            } else {
                resultado = '<div class="result result-approved"><strong>RESULTADO:</strong> CUENTA APROBADA<br><div style="background: #fff3cd; border: 2px solid #f39c12; border-radius: 8px; padding: 15px; margin: 15px 0; text-align: center;"><strong style="color: #856404;">ACCION OBLIGATORIA</strong><br><span style="color: #856404;">Debe registrar esta cuenta para continuar</span><br><button class="btn btn-success" onclick="abrirModalRegistro(2)" style="margin-top: 10px; animation: pulse 2s infinite;">REGISTRAR CUENTA OBLIGATORIO</button></div></div>';
            }
            document.getElementById('resultado2').innerHTML = resultado;
        }

        // Funciones de evaluaciÃ³n CUADRO 3
        function evaluarCuadro3(respuesta) {
            let resultado;
            if (respuesta === 'si') {
                resultado = '<div class="result result-rejected"><strong>RESULTADO:</strong> CUENTA RECHAZADA - Ãšltimo pago mayor a 4 aÃ±os</div>';
            } else {
                resultado = '<div class="result result-approved"><strong>RESULTADO:</strong> CUENTA APROBADA<br><div style="background: #fff3cd; border: 2px solid #f39c12; border-radius: 8px; padding: 15px; margin: 15px 0; text-align: center;"><strong style="color: #856404;">ACCION OBLIGATORIA</strong><br><span style="color: #856404;">Debe registrar esta cuenta para continuar</span><br><button class="btn btn-success" onclick="abrirModalRegistro(3)" style="margin-top: 10px; animation: pulse 2s infinite;">REGISTRAR CUENTA OBLIGATORIO</button></div></div>';
            }
            document.getElementById('resultado3').innerHTML = resultado;
        }

        // Funciones de evaluaciÃ³n CUADRO 4
        function evaluarCuadro4Mayor1Ano(respuesta) {
            // Ocultar calculadora si estaba visible
            document.getElementById('calculadora4').style.display = 'none';
            document.getElementById('montoPagar4').value = '';
            
            if (respuesta === 'si') {
                document.getElementById('resultado4').innerHTML = '<div class="result result-rejected"><strong>CUENTA NO CONSIDERADA:</strong> Ãšltimo pago mayor a 1 aÃ±o</div>';
            }
        }

        function mostrarCalculadora4() {
            // Ocultar resultado de "SI" si estaba visible
            document.getElementById('resultado4').innerHTML = '';
            document.getElementById('calculadora4').style.display = 'block';
        }

        function guardarMontoCuadro4() {
            const montoPagar = parseFloat(document.getElementById('montoPagar4').value);
            
            if (!montoPagar || montoPagar <= 0) {
                document.getElementById('resultado4').innerHTML = '<div class="result result-rejected">Por favor ingrese un monto valido</div>';
                return;
            }

            if (cuentasGuardadas >= 50) {
                document.getElementById('resultado4').innerHTML = '<div class="result result-rejected">Maximo 50 cuentas permitidas. Limpie el Cuadro 9 para continuar.</div>';
                return;
            }

            cuadroActual = 4;
            montoCalculado8 = montoPagar;
            
            const siguienteCuenta = encontrarSiguienteCuentaDisponible();
            if (siguienteCuenta) {
                registrarCuenta(siguienteCuenta);
                
                const montoFormateado = montoPagar.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'});
                document.getElementById('resultado4').innerHTML = `
                    <div class="result result-approved">
                        <strong>MONTO GUARDADO:</strong> ${montoFormateado}<br>
                        <small>Cuenta ${siguienteCuenta} registrada y guardada automaticamente en la suma total</small>
                    </div>
                `;
                
                document.getElementById('calculadora4').style.display = 'none';
                document.getElementById('montoPagar4').value = '';
            }
        }

        // Funciones de evaluaciÃ³n CUADRO 5
        function evaluarCuadro5(respuesta) {
            let resultado;
            if (respuesta === 'si') {
                resultado = '<div class="result result-rejected"><strong>RESULTADO:</strong> CUENTA RECHAZADA - Saldo menor a $8,000.00</div>';
            } else {
                resultado = '<div class="result result-approved"><strong>RESULTADO:</strong> CUENTA APROBADA<br><div style="background: #fff3cd; border: 2px solid #f39c12; border-radius: 8px; padding: 15px; margin: 15px 0; text-align: center;"><strong style="color: #856404;">ACCION OBLIGATORIA</strong><br><span style="color: #856404;">Debe registrar esta cuenta para continuar</span><br><button class="btn btn-success" onclick="abrirModalRegistro(5)" style="margin-top: 10px; animation: pulse 2s infinite;">REGISTRAR CUENTA OBLIGATORIO</button></div></div>';
            }
            document.getElementById('resultado5').innerHTML = resultado;
        }

        function resetearCuadro5() {
            document.getElementById('resultado5').innerHTML = '';
        }

        // Funciones de evaluaciÃ³n CUADRO 6 - PREGUNTA 1
        function mostrarPagoMinimo6() {
            // Ocultar el contenido de la pregunta 1 si estÃ¡ mostrando "NO"
            document.getElementById('resultado6a').innerHTML = '';
            document.getElementById('pagoMinimo6').style.display = 'none';
            document.getElementById('resultado6a').innerHTML = '<div class="result result-rejected"><strong>CUENTA RECHAZADA</strong><br>Fecha de apertura = Ãšltima compra</div>';
        }

        function mostrarPregunta2() {
            // Ocultar pago mÃ­nimo si estaba visible
            document.getElementById('pagoMinimo6').style.display = 'none';
            document.getElementById('pagoMinimo6Input').value = '';
            document.getElementById('resultado6a').innerHTML = '';
            
            // Ocultar toda la pregunta 1
            document.getElementById('pregunta1Container').style.display = 'none';
            
            // Mostrar la pregunta 2
            document.getElementById('pregunta2Container').style.display = 'block';
        }

        function cancelarPagoMinimo6() {
            document.getElementById('pagoMinimo6').style.display = 'none';
            document.getElementById('pagoMinimo6Input').value = '';
            document.getElementById('resultado6a').innerHTML = '';
        }

        function evaluarCuadro6Pregunta1(respuesta) {
            if (respuesta === 'no') {
                // Ocultar el pago mÃ­nimo si estaba visible
                document.getElementById('pagoMinimo6').style.display = 'none';
                document.getElementById('pagoMinimo6Input').value = '';
                mostrarIngresoMontoPregunta1();
            }
        }

        function mostrarIngresoMontoPregunta1() {
            document.getElementById('resultado6a').innerHTML = `
                <div style="background: #e6f7ed; padding: 20px; border-radius: 8px; border: 2px solid #27ae60; margin-top: 15px;">
                    <h4 style="color: #f39c12; margin-bottom: 15px;">Ingresar Monto</h4>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.95em;">Ingrese el monto que desea considerar para esta cuenta</p>
                    
                    <div class="form-group">
                        <label for="montoPregunta1Input">Monto a Considerar ($):</label>
                        <input type="number" id="montoPregunta1Input" placeholder="Ej: 500" step="0.01">
                    </div>

                    <div class="button-group">
                        <button class="btn btn-success" onclick="guardarMontoPregunta1()">Guardar Automaticamente</button>
                        <button class="btn btn-secondary" onclick="cancelarMontoPregunta1()">Cancelar</button>
                    </div>
                </div>
            `;
        }

        function cancelarMontoPregunta1() {
            document.getElementById('resultado6a').innerHTML = '';
            document.getElementById('montoPregunta1Input') && (document.getElementById('montoPregunta1Input').value = '');
        }

        function guardarMontoPregunta1() {
            const montoInput = parseFloat(document.getElementById('montoPregunta1Input').value);
            
            if (!montoInput || montoInput <= 0) {
                const resultadoDiv = document.createElement('div');
                resultadoDiv.className = 'result result-rejected';
                resultadoDiv.style.marginTop = '15px';
                resultadoDiv.innerHTML = 'Por favor ingrese un monto valido';
                
                const contenedorResultado = document.getElementById('resultado6a');
                const mensajeExistente = contenedorResultado.querySelector('.result');
                if (mensajeExistente) {
                    mensajeExistente.remove();
                }
                contenedorResultado.appendChild(resultadoDiv);
                return;
            }

            if (cuentasGuardadas >= 50) {
                const resultadoDiv = document.createElement('div');
                resultadoDiv.className = 'result result-rejected';
                resultadoDiv.style.marginTop = '15px';
                resultadoDiv.innerHTML = 'Maximo 50 cuentas permitidas. Limpie el Cuadro 9 para continuar.';
                
                const contenedorResultado = document.getElementById('resultado6a');
                const mensajeExistente = contenedorResultado.querySelector('.result');
                if (mensajeExistente) {
                    mensajeExistente.remove();
                }
                contenedorResultado.appendChild(resultadoDiv);
                return;
            }

            cuadroActual = 6;
            montoCalculado8 = montoInput;
            window.esMontoDirectoPregunta1 = true;
            
            const siguienteCuenta = encontrarSiguienteCuentaDisponible();
            if (siguienteCuenta) {
                registrarCuenta(siguienteCuenta);
                window.esMontoDirectoPregunta1 = false;
                
                const montoFormateado = montoInput.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'});
                document.getElementById('resultado6a').innerHTML = `
                    <div class="result result-approved">
                        <strong>MONTO GUARDADO:</strong> ${montoFormateado}<br>
                        <small>Cuenta ${siguienteCuenta} registrada y guardada automaticamente en la suma total</small>
                    </div>
                `;
            }
        }

        function guardarPagoMinimo6() {
            const pagoMinimo = parseFloat(document.getElementById('pagoMinimo6Input').value);
            
            if (!pagoMinimo || pagoMinimo <= 0) {
                document.getElementById('resultado6a').innerHTML = '<div class="result result-rejected">Por favor ingrese un pago minimo valido</div>';
                return;
            }

            if (cuentasGuardadas >= 50) {
                document.getElementById('resultado6a').innerHTML = '<div class="result result-rejected">Maximo 50 cuentas permitidas. Limpie el Cuadro 9 para continuar.</div>';
                return;
            }

            cuadroActual = 6;
            montoCalculado8 = pagoMinimo;
            window.esPagoMinimo6 = true;
            
            const siguienteCuenta = encontrarSiguienteCuentaDisponible();
            if (siguienteCuenta) {
                registrarCuenta(siguienteCuenta);
                window.esPagoMinimo6 = false;
                
                const montoFormateado = pagoMinimo.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'});
                document.getElementById('resultado6a').innerHTML = `
                    <div class="result result-approved">
                        <strong>PAGO MINIMO GUARDADO:</strong> ${montoFormateado}<br>
                        <small>Cuenta ${siguienteCuenta} registrada y guardada automaticamente en la suma total</small>
                    </div>
                `;
                
                document.getElementById('pagoMinimo6').style.display = 'none';
                document.getElementById('pagoMinimo6Input').value = '';
            }
        }

        function encontrarSiguienteCuentaDisponible() {
            for (let i = 1; i <= 50; i++) {
                if (!cuentasOcupadas.has(i)) {
                    return i;
                }
            }
            return null;
        }

        // Funciones de evaluaciï¿½ï¿½ï¿½ï¿½ï¿½ï¿½n CUADRO 6 - PREGUNTA 2
        function mostrarCalculadora6() {
            // Ocultar resultado de "NO" si estaba visible
            document.getElementById('resultado6b').innerHTML = '';
            document.getElementById('calculadora6').style.display = 'block';
        }

        function cancelarCalculadora6() {
            document.getElementById('resultadoCalculadora6').style.display = 'none';
            document.getElementById('btnCalcular6Container').style.display = 'block';
            document.getElementById('btnGuardar6Container').style.display = 'none';
            document.getElementById('saldoActual6').value = '';
            document.getElementById('pagoMinimo6Input').value = '';
            document.getElementById('resultado6b').innerHTML = '';
            
            // Limpiar cualquier error previo
            const contenedor = document.getElementById('calculadora6');
            let errorExistente = contenedor.querySelector('.result-rejected');
            if (errorExistente) errorExistente.remove();
        }

        function mostrarPagoMinimoPregunta2() {
            // Ocultar calculadora si estaba visible
            document.getElementById('calculadora6').style.display = 'none';
            document.getElementById('limiteCredito6').value = '';
            document.getElementById('resultado6b').innerHTML = '';
            
            // Mostrar input para pago mÃ­nimo
            document.getElementById('resultado6b').innerHTML = `
                <div style="background: #e6f7ed; padding: 12px; border-radius: 8px; border: 2px solid #27ae60; margin-top: 12px;">
                    <h4 style="color: #f39c12; margin-bottom: 10px; font-size: 0.95em;">Ingresar Pago MÃ­nimo</h4>
                    <p style="color: #666; margin-bottom: 10px; font-size: 0.85em;">El monto que ingrese se guardarÃ¡ directamente sin cÃ¡lculos adicionales.</p>
                    
                    <div class="form-group">
                        <label for="pagoMinimoPregunta2Input">Pago MÃ­nimo ($):</label>
                        <input type="number" id="pagoMinimoPregunta2Input" placeholder="Ej: 500" step="0.01">
                    </div>

                    <div class="button-group">
                        <button class="btn btn-success" onclick="guardarPagoMinimoPregunta2()">Guardar AutomÃ¡ticamente</button>
                        <button class="btn btn-secondary" onclick="cancelarPagoMinimoPregunta2()">Cancelar</button>
                    </div>
                </div>
            `;
        }

        function cancelarPagoMinimoPregunta2() {
            document.getElementById('resultado6b').innerHTML = '';
        }

        function guardarPagoMinimoPregunta2() {
            const pagoMinimo = parseFloat(document.getElementById('pagoMinimoPregunta2Input').value);
            
            if (!pagoMinimo || pagoMinimo <= 0) {
                const mensajeError = document.createElement('div');
                mensajeError.className = 'result result-rejected';
                mensajeError.style.marginTop = '15px';
                mensajeError.innerHTML = 'Por favor ingrese un pago mÃ­nimo vÃ¡lido';
                
                const contenedor = document.getElementById('resultado6b');
                const errorExistente = contenedor.querySelector('.result');
                if (errorExistente) {
                    errorExistente.remove();
                }
                contenedor.appendChild(mensajeError);
                return;
            }

            if (cuentasGuardadas >= 50) {
                const mensajeError = document.createElement('div');
                mensajeError.className = 'result result-rejected';
                mensajeError.style.marginTop = '15px';
                mensajeError.innerHTML = 'MÃ¡ximo 50 cuentas permitidas. Limpie el Cuadro 9 para continuar.';
                
                const contenedor = document.getElementById('resultado6b');
                const errorExistente = contenedor.querySelector('.result');
                if (errorExistente) {
                    errorExistente.remove();
                }
                contenedor.appendChild(mensajeError);
                return;
            }

            cuadroActual = 6;
            montoCalculado8 = pagoMinimo;
            window.esPagoMinimoPregunta2 = true;
            
            const siguienteCuenta = encontrarSiguienteCuentaDisponible();
            if (siguienteCuenta) {
                registrarCuenta(siguienteCuenta);
                window.esPagoMinimoPregunta2 = false;
                
                const montoFormateado = pagoMinimo.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'});
                document.getElementById('resultado6b').innerHTML = `
                    <div class="result result-approved">
                        <strong>PAGO MÃNIMO GUARDADO:</strong> ${montoFormateado}<br>
                        <small>Cuenta ${siguienteCuenta} registrada y guardada automÃ¡ticamente en la suma total</small>
                    </div>
                `;
            }
        }

        function evaluarCuadro6Pregunta2(respuesta) {
            // Ocultar la calculadora si estaba visible
            document.getElementById('calculadora6').style.display = 'none';
            document.getElementById('limiteCredito6').value = '';
            
            if (respuesta === 'no') {
                document.getElementById('resultado6b').innerHTML = '<div class="result result-rejected"><strong>CUENTA RECHAZADA</strong><br>NO tiene pago minimo $0 con saldo actual</div>';
            }
        }

        function calcularMontoCuadro6() {
            const saldoActual = parseFloat(document.getElementById('saldoActual6').value);
            const pagoMinimo = parseFloat(document.getElementById('pagoMinimo6Input').value) || 0;
            
            if (!saldoActual || saldoActual <= 0) {
                document.getElementById('resultadoCalculadora6').style.display = 'none';
                document.getElementById('btnGuardar6Container').style.display = 'none';
                const contenedor = document.getElementById('calculadora6');
                let errorExistente = contenedor.querySelector('.result-rejected');
                if (errorExistente) errorExistente.remove();
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'result result-rejected';
                errorDiv.style.marginTop = '10px';
                errorDiv.innerHTML = 'Por favor ingrese un saldo actual vÃ¡lido';
                contenedor.appendChild(errorDiv);
                return;
            }

            // Calcular el 1.6% del saldo actual
            const monto1_6Porciento = saldoActual * 0.016;

            // Determinar cuÃ¡l monto considerar
            let montoAConsiderar;
            let explicacion;
            
            if (pagoMinimo > 0) {
                if (pagoMinimo > monto1_6Porciento) {
                    montoAConsiderar = pagoMinimo;
                    explicacion = `<strong>Pago MÃ­nimo:</strong> ${pagoMinimo.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}<br>
                                   <strong>1.6% del Saldo:</strong> ${monto1_6Porciento.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}<br>
                                   <strong>Resultado:</strong> Se considera el Pago MÃ­nimo (es mayor)`;
                } else {
                    montoAConsiderar = monto1_6Porciento;
                    explicacion = `<strong>Pago MÃ­nimo:</strong> ${pagoMinimo.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}<br>
                                   <strong>1.6% del Saldo:</strong> ${monto1_6Porciento.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}<br>
                                   <strong>Resultado:</strong> Se considera el 1.6% (es mayor)`;
                }
            } else {
                montoAConsiderar = monto1_6Porciento;
                explicacion = `<strong>Pago MÃ­nimo:</strong> No ingresado<br>
                               <strong>1.6% del Saldo:</strong> ${monto1_6Porciento.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}<br>
                               <strong>Resultado:</strong> Se considera el 1.6% del saldo actual`;
            }

            // Guardar temporalmente para usar al guardar
            window.montoCalculado6Temp = montoAConsiderar;
            window.saldoUsado6 = saldoActual;
            window.pagoMinimoUsado6 = pagoMinimo;

            // Mostrar resultado con detalle
            document.getElementById('detalleCalculo6').innerHTML = explicacion;
            document.getElementById('montoResultado6').textContent = montoAConsiderar.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'});
            document.getElementById('resultadoCalculadora6').style.display = 'block';
            
            // Ocultar botÃ³n calcular y mostrar botÃ³n guardar
            document.getElementById('btnCalcular6Container').style.display = 'none';
            document.getElementById('btnGuardar6Container').style.display = 'block';
            
            // Limpiar cualquier error previo
            const contenedor = document.getElementById('calculadora6');
            let errorExistente = contenedor.querySelector('.result-rejected');
            if (errorExistente) errorExistente.remove();
        }

        function guardarMontoCuadro6Calculadora() {
            if (cuentasGuardadas >= 50) {
                const contenedor = document.getElementById('calculadora6');
                let errorExistente = contenedor.querySelector('.result-rejected');
                if (errorExistente) errorExistente.remove();
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'result result-rejected';
                errorDiv.style.marginTop = '10px';
                errorDiv.innerHTML = 'Maximo 50 cuentas permitidas. Limpie el Cuadro 9 para continuar.';
                contenedor.appendChild(errorDiv);
                return;
            }

            cuadroActual = 6;
            montoCalculado8 = window.montoCalculado6Temp;
            window.esCalculadora6Comparativo = true;
            
            const siguienteCuenta = encontrarSiguienteCuentaDisponible();
            if (siguienteCuenta) {
                registrarCuenta(siguienteCuenta);
                window.esCalculadora6Comparativo = false;
                
                const montoFormateado = window.montoCalculado6Temp.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'});
                document.getElementById('resultado6b').innerHTML = `
                    <div class="result result-approved">
                        <strong>MONTO GUARDADO:</strong> ${montoFormateado}<br>
                        <small>Cuenta ${siguienteCuenta} registrada y guardada automaticamente en la suma total</small>
                    </div>
                `;
                
                document.getElementById('calculadora6').style.display = 'none';
                document.getElementById('resultadoCalculadora6').style.display = 'none';
                document.getElementById('btnCalcular6Container').style.display = 'block';
                document.getElementById('btnGuardar6Container').style.display = 'none';
                document.getElementById('limiteCredito6').value = '';
                document.getElementById('saldoActual6').value = '';
            }
        }

        // Funciones de evaluaciÃ³n CUADRO 7
        function evaluarCuadro7(respuesta) {
            let resultado;
            if (respuesta === 'si') {
                resultado = '<div class="result result-approved"><strong>RESULTADO:</strong> CUENTA DUPLICADA A CONSIDERAR PARA CAPACIDAD DE PAGO<br><div style="background: #fff3cd; border: 2px solid #f39c12; border-radius: 8px; padding: 15px; margin: 15px 0; text-align: center;"><strong style="color: #856404;">ACCION OBLIGATORIA</strong><br><span style="color: #856404;">Debe registrar esta cuenta duplicada para continuar</span><br><button class="btn btn-success" onclick="abrirModalRegistro(7)" style="margin-top: 10px; animation: pulse 2s infinite;">REGISTRAR CUENTA OBLIGATORIO</button></div></div>';
            } else {
                resultado = '<div class="result result-consider"><strong>RESULTADO:</strong> NO HAY CUENTAS DUPLICADAS A CONSIDERAR<br><small>ContinÃºe con la evaluacion de otras cuentas</small></div>';
            }
            document.getElementById('resultado7').innerHTML = resultado;
        }

        // Funciones de reset
        function resetearCuadro1() {
            document.getElementById('fechaConsulta1').value = '';
            document.getElementById('fechaApertura1').value = '';
            document.getElementById('plazoMeses1').value = '';
            document.getElementById('resultado1').innerHTML = '';
        }

        function resetearCuadro2() {
            document.getElementById('resultado2').innerHTML = '';
        }

        function resetearCuadro3() {
            document.getElementById('resultado3').innerHTML = '';
        }

        function resetearCuadro4() {
            document.getElementById('calculadora4').style.display = 'none';
            document.getElementById('montoPagar4').value = '';
            document.getElementById('resultado4').innerHTML = '';
        }

        // Funciones de evaluaciÃ³n CUADRO 6 - PREGUNTA ÃšNICA CON CALCULADORA
        function rechazarCuadro6PreguntaUnica() {
            document.getElementById('resultado6a').innerHTML = '<div class="result result-rejected"><strong>CUENTA RECHAZADA</strong><br>Fecha de apertura = Ãšltima compra</div>';
            document.getElementById('calculadoraLimiteUnica').style.display = 'none';
            document.getElementById('resultado6').innerHTML = '';
        }

        function mostrarCalculadoraLimiteUnica() {
            document.getElementById('resultado6a').innerHTML = '';
            document.getElementById('resultado6').innerHTML = '';
            document.getElementById('calculadoraLimiteUnica').style.display = 'block';
        }

        function verificarMontoPagarUnica() {
            const montoPagar = parseFloat(document.getElementById('pagoMinimoUnica').value);
            const campoLimiteCredito = document.getElementById('campoLimiteCreditoUnica');
            const limiteCredito = document.getElementById('saldoActualUnica');
            
            // Si el monto a pagar es exactamente 0, mostrar el campo de lÃ­mite de crÃ©dito
            if (montoPagar === 0) {
                campoLimiteCredito.style.display = 'block';
            } else {
                campoLimiteCredito.style.display = 'none';
                limiteCredito.value = '';
            }
        }

        function cancelarCalculadoraUnica() {
            document.getElementById('calculadoraLimiteUnica').style.display = 'none';
            document.getElementById('saldoActualUnica').value = '';
            document.getElementById('pagoMinimoUnica').value = '';
            document.getElementById('saldoActualUnica').disabled = true;
            document.getElementById('resultadoCalculadoraUnica').style.display = 'none';
        }

        function calcularLimiteCreditoUnica() {
            const montoPagar = parseFloat(document.getElementById('pagoMinimoUnica').value);
            const limiteCredito = parseFloat(document.getElementById('saldoActualUnica').value) || 0;
            
            // Limpiar errores previos primero
            const contenedor = document.getElementById('calculadoraLimiteUnica');
            let errorExistente = contenedor.querySelector('.result-rejected');
            if (errorExistente) errorExistente.remove();
            
            // Validar que se haya ingresado monto a pagar
            if (isNaN(montoPagar) || montoPagar < 0) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'result result-rejected';
                errorDiv.style.marginTop = '10px';
                errorDiv.innerHTML = 'Por favor ingrese un monto a pagar vÃ¡lido (puede ser $0)';
                contenedor.appendChild(errorDiv);
                return;
            }

            let montoAConsiderar;
            let explicacion;
            
            // Caso 1: Si monto a pagar es 0, se debe calcular el 1.6% del lÃ­mite de crÃ©dito
            if (montoPagar === 0) {
                if (limiteCredito <= 0) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'result result-rejected';
                    errorDiv.style.marginTop = '10px';
                    errorDiv.innerHTML = 'Cuando el Monto a Pagar es $0, debe ingresar un LÃ­mite de CrÃ©dito vÃ¡lido';
                    contenedor.appendChild(errorDiv);
                    return;
                }
                
                montoAConsiderar = limiteCredito * 0.016;
                explicacion = `
                    <p style="margin: 8px 0;"><strong>Monto a Pagar:</strong> $0.00</p>
                    <p style="margin: 8px 0;"><strong>LÃ­mite de CrÃ©dito:</strong> ${limiteCredito.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}</p>
                    <p style="margin: 8px 0;"><strong>1.6% del LÃ­mite:</strong> ${montoAConsiderar.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}</p>
                    <p style="margin: 10px 0 0 0; color: #27ae60; font-weight: bold;">ï¿½ï¿½ Se considera el 1.6% del LÃ­mite de CrÃ©dito</p>
                `;
            }
            // Caso 2: Si monto a pagar tiene valor, solo se considera ese monto
            else {
                montoAConsiderar = montoPagar;
                explicacion = `
                    <p style="margin: 8px 0;"><strong>Monto a Pagar:</strong> ${montoPagar.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}</p>
                    <p style="margin: 10px 0 0 0; color: #27ae60; font-weight: bold;">âœ“ Se considera el Monto a Pagar digitado</p>
                `;
            }

            // Guardar temporalmente para usar al guardar
            window.montoLimiteCreditoUnica = montoAConsiderar;

            // Ocultar la calculadora y mostrar solo el resultado
            document.getElementById('calculadoraLimiteUnica').style.display = 'none';

            // Mostrar resultado en el Ã¡rea principal
            document.getElementById('resultado6').innerHTML = `
                <div style="background: white; border: 3px solid #3498db; border-radius: 8px; padding: 20px; margin: 15px 0;">
                    <h4 style="color: #2c5282; margin: 0 0 15px 0; font-size: 1.05em;">ğŸ“Š Resultados del CÃ¡lculo:</h4>
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 15px; font-size: 0.9em;">${explicacion}</div>
                    
                    <div style="background: #e8f5e9; border: 2px solid #27ae60; border-radius: 6px; padding: 15px; margin: 15px 0; text-align: center;">
                        <p style="margin: 0 0 5px 0; color: #2c5282; font-weight: 600;">ğŸ’° Monto Final a Considerar:</p>
                        <p style="margin: 0; color: #27ae60; font-size: 1.8em; font-weight: bold;">${montoAConsiderar.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}</p>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-success" onclick="guardarLimiteCreditoUnica()">Guardar AutomÃ¡ticamente</button>
                        <button class="btn btn-secondary" onclick="cancelarResultadoCalculadoraUnica()">Cancelar</button>
                    </div>
                </div>
            `;
        }

        function cancelarResultadoCalculadoraUnica() {
            document.getElementById('resultado6').innerHTML = '';
            document.getElementById('saldoActualUnica').value = '';
            document.getElementById('pagoMinimoUnica').value = '';
        }

        function guardarLimiteCreditoUnica() {
            if (cuentasGuardadas >= 50) {
                const contenedor = document.getElementById('calculadoraLimiteUnica');
                let errorExistente = contenedor.querySelector('.result-rejected');
                if (errorExistente) errorExistente.remove();
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'result result-rejected';
                errorDiv.style.marginTop = '10px';
                errorDiv.innerHTML = 'Maximo 50 cuentas permitidas. Limpie el Cuadro 9 para continuar.';
                contenedor.appendChild(errorDiv);
                return;
            }

            cuadroActual = 6;
            montoCalculado8 = window.montoLimiteCreditoUnica;
            window.esLimiteCreditoUnica = true;
            
            const siguienteCuenta = encontrarSiguienteCuentaDisponible();
            if (siguienteCuenta) {
                registrarCuenta(siguienteCuenta);
                window.esLimiteCreditoUnica = false;
                
                const montoFormateado = window.montoLimiteCreditoUnica.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'});
                document.getElementById('resultado6').innerHTML = `
                    <div class="result result-approved">
                        <strong>LÃMITE DE CRÃ‰DITO GUARDADO:</strong> ${montoFormateado}<br>
                        <small>Cuenta ${siguienteCuenta} registrada y guardada automaticamente en la suma total</small>
                    </div>
                `;
                
                // Limpiar y ocultar calculadora
                document.getElementById('calculadoraLimiteUnica').style.display = 'none';
                document.getElementById('saldoActualUnica').value = '';
                document.getElementById('pagoMinimoUnica').value = '';
                document.getElementById('resultadoCalculadoraUnica').style.display = 'none';
            }
        }

        function resetearCuadro6() {
            // Limpiar calculadora de lÃ­mite Ãºnica
            document.getElementById('calculadoraLimiteUnica').style.display = 'none';
            document.getElementById('pagoMinimoUnica').value = '';
            document.getElementById('saldoActualUnica').value = '';
            document.getElementById('campoLimiteCreditoUnica').style.display = 'none';
            
            // Limpiar todos los resultados
            document.getElementById('resultado6').innerHTML = '';
            document.getElementById('resultado6a').innerHTML = '';
            
            // Limpiar cualquier variable temporal
            window.montoLimiteCreditoUnica = 0;
            window.esLimiteCreditoUnica = false;
            window.esPagoMinimo6 = false;
            window.esPagoMinimoPregunta2 = false;
            window.esCalculadora6Comparativo = false;
            window.esMontoDirectoPregunta1 = false;
            window.montoCalculado6Temp = 0;
            window.saldoUsado6 = 0;
            window.pagoMinimoUsado6 = 0;
            
            // Resetear montoCalculado8 si venï¿½ï¿½a del cuadro 6
            if (cuadroActual === 6) {
                montoCalculado8 = 0;
            }
        }

        function resetearCuadro7() {
            document.getElementById('resultado7').innerHTML = '';
        }

        // Funciones del Modal de Registro
        function abrirModalRegistro(numeroCuadro) {
            cuadroActual = numeroCuadro;
            generarBotonesModal();
            document.getElementById('modalRegistrarCuenta').style.display = 'block';
        }

        function cerrarModal() {
            document.getElementById('modalRegistrarCuenta').style.display = 'none';
        }

        function generarBotonesModal() {
            const grid = document.getElementById('accountGrid');
            grid.innerHTML = '';
            
            const modalHeader = document.querySelector('#modalRegistrarCuenta .modal-header h3');
            modalHeader.textContent = 'REGISTRAR CUENTA';
            const modalSubtitle = document.querySelector('#modalRegistrarCuenta .modal-header p');
            modalSubtitle.textContent = 'Seleccione el numero de cuenta para registrar';
            
            for (let i = 1; i <= 50; i++) {
                const btn = document.createElement('button');
                btn.className = cuentasOcupadas.has(i) ? 'account-btn occupied' : 'account-btn';
                btn.textContent = i;
                
                if (cuentasOcupadas.has(i)) {
                    btn.disabled = true;
                    btn.title = 'Cuenta ya ocupada';
                } else {
                    btn.onclick = () => registrarCuenta(i);
                    btn.title = 'Click para registrar en esta cuenta';
                }
                
                grid.appendChild(btn);
            }
        }

        function registrarCuenta(numeroCuenta) {
            cuentasOcupadas.add(numeroCuenta);
            cuentasGuardadas++;
            
            const tipoCuenta = obtenerTipoCuenta(cuadroActual);
            const fechaEvaluacion = obtenerFechaEvaluacion(cuadroActual);
            
            let montoAsignar = 0;
            let esGuardadaAutomatica = false;
            
            if (montoCalculado8 > 0) {
                montoAsignar = montoCalculado8;
                // Marcar como guardada automÃ¡tica si viene de cuadros 4 o 6
                if (cuadroActual === 4 || cuadroActual === 6) {
                    esGuardadaAutomatica = true;
                }
            }
            
            cuentasRegistradas[numeroCuenta] = {
                cuadro: cuadroActual,
                tipoCuenta: tipoCuenta,
                fecha: fechaEvaluacion,
                monto: montoAsignar,
                estado: 'registrada',
                esPagoMinimo: window.esPagoMinimo6 || false,
                esPagoMinimoPregunta2: window.esPagoMinimoPregunta2 || false,
                guardadaAutomatica: esGuardadaAutomatica
            };
            
            const contenedorCuenta = document.getElementById(`cuenta${numeroCuenta}-container`);
            contenedorCuenta.style.display = 'block';
            
            // Aplicar estilo especial si es guardada automÃ¡tica
            if (esGuardadaAutomatica) {
                contenedorCuenta.classList.add('guardada-automaticamente');
                
                // Agregar subtÃ­tulo indicando que es guardada automÃ¡ticamente
                const labelDiv = contenedorCuenta.querySelector('div');
                const labelElement = labelDiv.querySelector('label');
                
                // Verificar si ya existe el subtÃ­tulo para no duplicarlo
                if (!labelElement.querySelector('.cuenta-subtitulo-automatica')) {
                    const subtitulo = document.createElement('span');
                    subtitulo.className = 'cuenta-subtitulo-automatica';
                    subtitulo.textContent = `(${tipoCuenta})`;
                    labelElement.appendChild(document.createElement('br'));
                    labelElement.appendChild(subtitulo);
                }
            }
            
            if (montoAsignar > 0) {
                document.getElementById(`cuenta${numeroCuenta}`).value = montoAsignar.toFixed(2);
            }
            
            if (cuentasGuardadas === 1) {
                document.getElementById('sinCuentas').style.display = 'none';
            }
            
            document.getElementById('numCuentas').textContent = cuentasGuardadas;
            
            let mensaje;
            if (montoAsignar > 0) {
                const montoFormateado = montoAsignar.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'});
                mensaje = `<div class="result result-approved"><strong>CUENTA REGISTRADA Y GUARDADA:</strong> Cuenta ${numeroCuenta} - ${tipoCuenta}<br><strong>Monto guardado automaticamente:</strong> ${montoFormateado}<br><small>El monto ha sido guardado automaticamente en el total</small></div>`;
            } else {
                mensaje = `<div class="result result-approved"><strong>CUENTA REGISTRADA:</strong> Cuenta ${numeroCuenta} reservada para ${tipoCuenta}</div>`;
            }
            
            document.getElementById(`resultado${cuadroActual}`).innerHTML = mensaje;
            
            if (cuadroActual === 4 || cuadroActual === 6) {
                montoCalculado8 = 0;
                if (cuadroActual === 4) {
                    resetearCuadro4();
                } else {
                    resetearCuadro6();
                }
            }
            
            cerrarModal();
        }

        // Funciones del CUADRO 8
        function calcularCapacidadPago() {
            const saldoActual = parseFloat(document.getElementById('saldoActual8').value);
            const monto = parseFloat(document.getElementById('monto8').value);
            const tipoPlazo = document.getElementById('plazo8').value;
            
            if (!saldoActual || !monto || !tipoPlazo) {
                document.getElementById('resultado8').innerHTML = '<div class="result result-rejected">Por favor complete todos los campos</div>';
                return;
            }
            
            const factoresPlazo = {
                'diario': 30,
                'semanal': 4,
                'catorcenal': 2,
                'quincenal': 2,
                'mensual': 1,
                'pago_minimo': 1,
                'variable': 1,
                'bimestral': 0.5,
                'trimestral': 0.33,
                'semestral': 0.17,
                'anual': 0.08
            };
            
            const factor = factoresPlazo[tipoPlazo];
            const montoXPlazo = monto * factor;
            
            let montoAConsiderar;
            let resultado;
            
            if (montoXPlazo < saldoActual) {
                montoAConsiderar = montoXPlazo;
                resultado = '<div class="result result-approved"><strong>RESULTADO:</strong> APROBADO - Se considerara MONTO x PLAZO</div>';
            } else {
                montoAConsiderar = saldoActual;
                resultado = '<div class="result result-approved"><strong>RESULTADO:</strong> APROBADO - Se considerara SALDO ACTUAL</div>';
            }
            
            montoCalculado8 = montoAConsiderar;
            
            const tipoPlazoTexto = tipoPlazo.toUpperCase();
            
            const detalles = `
                <div style="background: #e8f4f8; border-left: 4px solid #3498db; padding: 20px; margin-top: 15px; border-radius: 8px;">
                    <h4 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 1.1em;">Detalles del Calculo:</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <p style="margin: 8px 0;"><strong>Monto (Pago):</strong><br>${monto.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}</p>
                            <p style="margin: 8px 0;"><strong>Periodicidad:</strong><br>${tipoPlazoTexto}</p>
                            <p style="margin: 8px 0;"><strong>Factor de conversion:</strong><br>Ã—${factor}</p>
                            <p style="margin: 8px 0;"><strong>Monto x Plazo:</strong><br>${montoXPlazo.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}</p>
                        </div>
                        <div>
                            <p style="margin: 8px 0;"><strong>Saldo Actual:</strong><br>${saldoActual.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}</p>
                            <p style="margin: 8px 0;"><strong>Comparacion:</strong><br>${montoXPlazo.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})} ${montoXPlazo < saldoActual ? '<' : '>='} ${saldoActual.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}</p>
                            <p style="margin: 8px 0; font-size: 1.1em; color: #27ae60;"><strong>Monto a Considerar:</strong><br><span style="font-size: 1.3em;">${montoAConsiderar.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}</span></p>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('resultado8').innerHTML = resultado;
            document.getElementById('detalleCalculo8').innerHTML = detalles;
            document.getElementById('btnGuardar8').style.display = 'inline-block';
        }

        function validarYGuardar() {
            if (montoCalculado8 <= 0) {
                document.getElementById('resultado8').innerHTML = '<div class="result result-rejected">Primero debe calcular un monto valido</div>';
                return;
            }
            
            const cuentasSinMonto = Object.entries(cuentasRegistradas).filter(([num, datos]) => 
                datos.cuadro !== 8 && datos.monto === 0
            );
            
            if (cuentasSinMonto.length > 0 || cuentasGuardadas < 50) {
                cuadroActual = 8;
                generarBotonesModalCalculadora();
                document.getElementById('modalRegistrarCuenta').style.display = 'block';
            }
        }

        function generarBotonesModalCalculadora() {
            const grid = document.getElementById('accountGrid');
            grid.innerHTML = '';
            
            const modalHeader = document.querySelector('#modalRegistrarCuenta .modal-header h3');
            modalHeader.textContent = 'CONECTAR CON CUENTA REGISTRADA';
            const modalSubtitle = document.querySelector('#modalRegistrarCuenta .modal-header p');
            modalSubtitle.textContent = 'Seleccione la cuenta del Paso 1 para asignar el monto calculado';
            
            const cuentasSinMonto = Object.entries(cuentasRegistradas).filter(([num, datos]) => 
                datos.cuadro !== 8 && datos.monto === 0
            );
            
            if (cuentasSinMonto.length > 0) {
                const seccionPaso1 = document.createElement('div');
                seccionPaso1.innerHTML = '<h4 style="text-align: center; color: #27ae60; margin: 0 0 15px 0; font-size: 1.1em;">CUENTAS REGISTRADAS DEL PASO 1</h4>';
                grid.appendChild(seccionPaso1);
                
                cuentasSinMonto.forEach(([numeroCuenta, datos]) => {
                    const btn = document.createElement('button');
                    btn.className = 'account-btn';
                    btn.style.background = 'linear-gradient(135deg, #27ae60 0%, #20873a 100%)';
                    btn.style.borderColor = '#27ae60';
                    btn.style.color = 'white';
                    btn.innerHTML = `${numeroCuenta}<br><small style="font-size: 11px; opacity: 0.9;">${datos.tipoCuenta}</small>`;
                    btn.onclick = () => conectarConCuentaRegistrada(parseInt(numeroCuenta));
                    btn.title = `Cuenta ${numeroCuenta}: ${datos.tipoCuenta}`;
                    grid.appendChild(btn);
                });
            } else {
                const mensaje = document.createElement('div');
                mensaje.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #666; background: #fff3cd; border-radius: 12px; border: 2px solid #ffc107;">
                        <h4 style="color: #856404; margin-bottom: 15px; font-size: 1.2em;">NO HAY CUENTAS DEL PASO 1 DISPONIBLES</h4>
                        <p style="margin: 10px 0; color: #666;">Para usar la calculadora, primero debe:</p>
                        <ol style="text-align: left; display: inline-block; margin: 15px 0; color: #555;">
                            <li style="margin: 8px 0;">Evaluar cuentas en el Paso 1</li>
                            <li style="margin: 8px 0;">Registrar las cuentas que apliquen</li>
                            <li style="margin: 8px 0;">Luego usar la calculadora para asignar montos</li>
                        </ol>
                        <p style="font-style: italic; color: #856404; margin-top: 15px; font-weight: 600;">La calculadora solo conecta con cuentas ya registradas del Paso 1</p>
                    </div>
                `;
                grid.appendChild(mensaje);
            }
        }

        function conectarConCuentaRegistrada(numeroCuenta) {
            cuentasRegistradas[numeroCuenta].monto = montoCalculado8;
            
            const campo = document.getElementById(`cuenta${numeroCuenta}`);
            campo.value = montoCalculado8.toFixed(2);
            
            const montoFormateado = montoCalculado8.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'});
            const tipoCuenta = cuentasRegistradas[numeroCuenta].tipoCuenta;
            
            document.getElementById('resultado8').innerHTML = `
                <div class="result result-approved" style="animation: slideIn 0.5s ease;">
                    <h4 style="margin: 0 0 10px 0; color: #27ae60;">CONEXION EXITOSA</h4>
                    <p style="margin: 5px 0;"><strong>Cuenta #${numeroCuenta}:</strong> ${tipoCuenta}</p>
                    <p style="margin: 5px 0; font-size: 1.2em; color: #27ae60;"><strong>Monto asignado:</strong> ${montoFormateado}</p>
                    <p style="margin: 10px 0 0 0; font-size: 0.9em; opacity: 0.8;">La cuenta del Paso 1 ahora tiene su monto calculado y esta lista para el Paso 3</p>
                </div>
            `;
            
            resetearCuadro8();
            cerrarModal();
        }

        function resetearCuadro8() {
            document.getElementById('saldoActual8').value = '';
            document.getElementById('monto8').value = '';
            document.getElementById('plazo8').selectedIndex = 0;
            document.getElementById('resultado8').innerHTML = '';
            document.getElementById('detalleCalculo8').innerHTML = '';
            document.getElementById('btnGuardar8').style.display = 'none';
            montoCalculado8 = 0;
        }

        // Funciones del CUADRO 9
        function sumarTotal() {
            let total = 0;
            let cuentasConValor = 0;
            
            for (let i = 1; i <= 50; i++) {
                const valor = parseFloat(document.getElementById(`cuenta${i}`).value) || 0;
                if (valor > 0) {
                    total += valor;
                    cuentasConValor++;
                    
                    if (cuentasRegistradas[i]) {
                        cuentasRegistradas[i].monto = valor;
                    }
                }
            }
            
            totalCapacidadPago = total;
            
            const totalFormateado = total.toLocaleString('es-MX', {
                style: 'currency',
                currency: 'MXN'
            });
            
            let resultado;
            if (total > 0) {
                resultado = `
                    <div class="result result-approved">
                        <h3 style="margin: 0 0 10px 0;">CAPACIDAD DE PAGO TOTAL</h3>
                        <p style="font-size: 1.5em; margin: 10px 0;"><strong>${totalFormateado}</strong></p>
                        <p style="margin: 5px 0;">Cuentas consideradas: ${cuentasConValor}</p>
                        <p style="margin: 5px 0; font-size: 0.9em;">Esta es la capacidad de pago mensual calculada</p>
                    </div>
                `;
                
                document.getElementById('btnFicha').style.display = 'inline-block';
            } else {
                resultado = '<div class="result result-rejected">No hay cuentas con valores para sumar</div>';
                document.getElementById('btnFicha').style.display = 'none';
            }
            
            document.getElementById('resultado9').innerHTML = resultado;
        }

        function resetearCuadro9() {
            // Limpiar cuentas registradas
            for (let i = 1; i <= 50; i++) {
                const contenedor = document.getElementById(`cuenta${i}-container`);
                document.getElementById(`cuenta${i}`).value = '';
                contenedor.style.display = 'none';
                contenedor.classList.remove('guardada-automaticamente');
            }
            document.getElementById('resultado9').innerHTML = '';
            document.getElementById('sinCuentas').style.display = 'block';
            cuentasGuardadas = 0;
            cuentasOcupadas.clear();
            cuentasRegistradas = {};
            totalCapacidadPago = 0;
            document.getElementById('numCuentas').textContent = '0';
            document.getElementById('btnFicha').style.display = 'none';
            
            // LIMPIAR TODOS LOS CUADROS DEL PASO 1
            resetearCuadro1();
            resetearCuadro2();
            resetearCuadro3();
            resetearCuadro4();
            resetearCuadro5();
            resetearCuadro6();
            resetearCuadro7();
            
            // LIMPIAR CUADRO 8 (CALCULADORA)
            resetearCuadro8();
            
            // Mostrar mensaje de confirmaciÃ³n
            document.getElementById('resultado9').innerHTML = `
                <div class="result result-approved" style="animation: slideIn 0.5s ease;">
                    <h4 style="margin: 0 0 8px 0; color: #27ae60;">âœ“ SISTEMA REINICIADO COMPLETAMENTE</h4>
                    <p style="margin: 5px 0;">Todos los cuadros han sido limpiados y reiniciados para nuevas evaluaciones</p>
                    <p style="margin: 5px 0; font-size: 0.9em; opacity: 0.8;">Puede comenzar nuevamente desde el Paso 1</p>
                </div>
            `;
        }

        function limpiarSoloCalculadora() {
            // Solo limpia los montos de las cuentas que fueron sincronizadas desde la calculadora
            for (let i = 1; i <= 50; i++) {
                if (cuentasRegistradas[i] && cuentasRegistradas[i].cuadro === 8) {
                    // Eliminar solo las cuentas que vienen de la calculadora (cuadro 8)
                    document.getElementById(`cuenta${i}`).value = '';
                    document.getElementById(`cuenta${i}-container`).style.display = 'none';
                    delete cuentasRegistradas[i];
                    cuentasOcupadas.delete(i);
                    cuentasGuardadas--;
                }
            }
            
            // Limpiar el resultado y ocultar el botÃ³n de ficha
            document.getElementById('resultado9').innerHTML = '<div class="result result-consider"><strong>CALCULADORA LIMPIADA</strong><br>Se eliminaron las cuentas sincronizadas desde la calculadora. Las cuentas del Paso 1 se mantienen intactas.</div>';
            document.getElementById('btnFicha').style.display = 'none';
            totalCapacidadPago = 0;
            document.getElementById('numCuentas').textContent = cuentasGuardadas;
            
            // Si no quedan cuentas, mostrar mensaje de sin cuentas
            if (cuentasGuardadas === 0) {
                document.getElementById('sinCuentas').style.display = 'block';
            }
        }

        function eliminarCuenta(numeroCuenta) {
            if (!cuentasRegistradas[numeroCuenta]) {
                return;
            }

            const cuenta = cuentasRegistradas[numeroCuenta];
            const cuadroOrigen = cuenta.cuadro;
            
            // Si la cuenta fue guardada automÃ¡ticamente (cuadros 4 o 6), eliminarla definitivamente
            if (cuadroOrigen === 4 || cuadroOrigen === 6) {
                // Eliminar definitivamente
                const contenedor = document.getElementById(`cuenta${numeroCuenta}-container`);
                document.getElementById(`cuenta${numeroCuenta}`).value = '';
                contenedor.style.display = 'none';
                contenedor.classList.remove('guardada-automaticamente');
                delete cuentasRegistradas[numeroCuenta];
                cuentasOcupadas.delete(numeroCuenta);
                cuentasGuardadas--;
                
                document.getElementById('numCuentas').textContent = cuentasGuardadas;
                
                if (cuentasGuardadas === 0) {
                    document.getElementById('sinCuentas').style.display = 'block';
                }
            } else {
                // Para cuentas del Paso 1 (cuadros 1, 2, 3, 5, 7) o de la calculadora (cuadro 8)
                // Solo quitar el monto, pero mantener la cuenta registrada disponible para reconectar
                cuenta.monto = 0;
                document.getElementById(`cuenta${numeroCuenta}`).value = '';
            }
            
            // Limpiar resultado total y ocultar boton de ficha
            document.getElementById('btnFicha').style.display = 'none';
            totalCapacidadPago = 0;
        }

        // Funciones auxiliares
        function obtenerTipoCuenta(cuadro) {
            const tipos = {
                1: 'Cuentas MOP 01 Y 02',
                2: 'Cuentas MOP 01-04',
                3: 'Cuentas MOP 05 o mÃ¡s (Socios nuevos)',
                4: 'Cuentas MOP 05 o mÃ¡s (Historial Acreimex)',
                5: 'Tarjetas de Credito y Servicios',
                6: 'Creditos Revolventes',
                7: 'Cuentas Duplicadas y Renovacion',
                8: 'Calculadora de Capacidad de Pago'
            };
            return tipos[cuadro] || 'Tipo no especificado';
        }

        function obtenerComoAplica(cuadro, esPagoMinimo = false, esPagoMinimoPregunta2 = false) {
            const criterios = {
                1: 'Fecha de consulta menor a (apertura + plazo + 1 mes)',
                2: 'Sin fecha de cierre en columna CIERRE',
                3: 'Ultimo pago menor a 4 aï¿½ï¿½ï¿½ï¿½os',
                4: 'Ultimo pago NO mayor a 1 aÃ±o - Socios con historial en Acreimex (monto directo ingresado)',
                5: 'Saldo actual mayor a $8,000.00',
                6: esPagoMinimo ? 'Fecha de apertura = ultima compra Y se ingreso pago minimo' : 'Calculadora de lÃ­mite de crÃ©dito: Se considerÃ³ el mayor entre pago mÃ­nimo y 1.6% del saldo actual',
                7: 'Cuenta duplicada identificada manualmente',
                8: 'Calculado mediante formula: menor entre (MONTO x PLAZO) y SALDO ACTUAL'
            };
            return criterios[cuadro] || 'Criterio no especificado';
        }

        function obtenerFechaEvaluacion(cuadro) {
            if (cuadro === 1) {
                const fechaConsulta = document.getElementById('fechaConsulta1').value;
                const fechaApertura = document.getElementById('fechaApertura1').value;
                const plazoMeses = parseInt(document.getElementById('plazoMeses1').value);
                
                if (fechaConsulta && fechaApertura && plazoMeses) {
                    const fechaLimite = new Date(fechaApertura);
                    fechaLimite.setMonth(fechaLimite.getMonth() + plazoMeses + 1);
                    
                    return {
                        fechaConsulta: fechaConsulta,
                        fechaApertura: fechaApertura,
                        plazoMeses: plazoMeses,
                        fechaLimite: fechaLimite.toLocaleDateString('es-MX'),
                        mostrarFechas: true
                    };
                }
            }
            return {
                mostrarFechas: false,
                fecha: new Date().toLocaleDateString('es-MX')
            };
        }

        // Sistema de arrastre para modales
        let isDragging = false;
        let currentModal = null;
        let startX = 0;
        let startY = 0;
        let initialX = 0;
        let initialY = 0;

        function inicializarArrastre() {
            const modalFicha = document.querySelector('#modalFichaCapacidad .modal-content');
            modalFicha.classList.add('draggable');
            
            const headerFicha = document.querySelector('#modalFichaCapacidad .modal-header');
            headerFicha.classList.add('draggable-header');
            headerFicha.addEventListener('mousedown', iniciarArrastre);
            
            document.addEventListener('mousemove', arrastrar);
            document.addEventListener('mouseup', terminarArrastre);
        }

        function iniciarArrastre(e) {
            if (e.target.classList.contains('close') || e.target.tagName === 'BUTTON') return;
            
            isDragging = true;
            currentModal = e.target.closest('.modal-content');
            currentModal.classList.add('dragging');
            
            startX = e.clientX;
            startY = e.clientY;
            
            const rect = currentModal.getBoundingClientRect();
            initialX = rect.left;
            initialY = rect.top;
            
            e.preventDefault();
        }

        function arrastrar(e) {
            if (!isDragging || !currentModal) return;
            
            e.preventDefault();
            
            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;
            
            let newX = initialX + deltaX;
            let newY = initialY + deltaY;
            
            const modalRect = currentModal.getBoundingClientRect();
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            
            newX = Math.max(0, Math.min(newX, windowWidth - modalRect.width));
            newY = Math.max(0, Math.min(newY, windowHeight - modalRect.height));
            
            currentModal.style.left = newX + 'px';
            currentModal.style.top = newY + 'px';
            currentModal.style.transform = 'none';
            currentModal.style.margin = '0';
        }

        function terminarArrastre() {
            if (isDragging && currentModal) {
                currentModal.classList.remove('dragging');
                isDragging = false;
                currentModal = null;
            }
        }

        // Funciones de la ficha
        function generarFichaCapacidad() {
            const fechaActual = new Date().toLocaleDateString('es-MX', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            let contenidoFicha = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: #2c3e50; margin: 0;">FICHA DE CAPACIDAD DE PAGO</h2>
                    <p style="color: #666; margin: 5px 0;">Fecha de evaluacion: ${fechaActual}</p>
                </div>

                <div style="background: #f8f9fa; border: 2px solid #3498db; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #2c3e50; margin: 0 0 15px 0;">RESUMEN EJECUTIVO</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <p><strong>Total de cuentas evaluadas:</strong> ${Object.keys(cuentasRegistradas).length}</p>
                            <p><strong>Cuentas con monto:</strong> ${Object.values(cuentasRegistradas).filter(c => c.monto > 0).length}</p>
                        </div>
                        <div>
                            <p><strong>Capacidad de pago total:</strong></p>
                            <p style="font-size: 1.3em; color: #27ae60; font-weight: bold;">${totalCapacidadPago.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}</p>
                        </div>
                    </div>
                </div>

                <h3 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">DETALLE DE CUENTAS EVALUADAS</h3>
            `;

            let tablaCuentas = `
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                    <thead>
                        <tr style="background: #3498db; color: white;">
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Cuentas Aplico del Paso 1</th>
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Como Aplica</th>
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: right;">Monto o Saldo que se Considero</th>
                            <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Fecha (Solo MOP 01 Y 02)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            for (let [numeroCuenta, datos] of Object.entries(cuentasRegistradas)) {
                if (datos.monto > 0) {
                    let fechaTexto = '';
                    let comoAplica = obtenerComoAplica(datos.cuadro, datos.esPagoMinimo, datos.esPagoMinimoPregunta2);
                    
                    if (datos.fecha && datos.fecha.mostrarFechas && datos.cuadro === 1) {
                        fechaTexto = `${datos.fecha.fechaLimite}`;
                    } else {
                        fechaTexto = '';
                    }
                    
                    tablaCuentas += `
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 10px;">${datos.tipoCuenta}</td>
                            <td style="border: 1px solid #ddd; padding: 10px;">${comoAplica}</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">${datos.monto.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}</td>
                            <td style="border: 1px solid #ddd; padding: 10px;">${fechaTexto}</td>
                        </tr>
                    `;
                }
            }

            tablaCuentas += `
                    </tbody>
                    <tfoot>
                        <tr style="background: #f8f9fa; font-weight: bold;">
                            <td colspan="2" style="border: 1px solid #ddd; padding: 12px; text-align: right;">TOTAL:</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: right; color: #27ae60;">${totalCapacidadPago.toLocaleString('es-MX', {style: 'currency', currency: 'MXN'})}</td>
                            <td style="border: 1px solid #ddd; padding: 12px;"></td>
                        </tr>
                    </tfoot>
                </table>
            `;

            const analisisPoliticas = generarAnalisisPoliticas();

            contenidoFicha += tablaCuentas + analisisPoliticas;

            document.getElementById('fichaContent').innerHTML = contenidoFicha;
            document.getElementById('modalFichaCapacidad').style.display = 'block';
            
            setTimeout(() => {
                inicializarArrastre();
            }, 100);
        }

        function generarAnalisisPoliticas() {
            let analisis = `
                <h3 style="color: #2c3e50; border-bottom: 2px solid #f39c12; padding-bottom: 10px;">ANALISIS DE POLITICAS</h3>
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
            `;

            const tiposCuentas = Object.values(cuentasRegistradas).map(c => c.cuadro);
            const cuentasConMonto = Object.values(cuentasRegistradas).filter(c => c.monto > 0);

            if (tiposCuentas.includes(1)) {
                analisis += '<p><strong>Cuentas MOP 01-02:</strong> Evaluadas segun criterio de plazo y fechas.</p>';
            }
            if (tiposCuentas.includes(2)) {
                analisis += '<p><strong>Cuentas MOP 01-04:</strong> Evaluadas segun fecha de cierre.</p>';
            }
            if (tiposCuentas.includes(3)) {
                analisis += '<p><strong>Cuentas MOP 05+:</strong> Evaluadas segÃºn ultimo pago (criterio 4 aÃ±os).</p>';
            }
            if (tiposCuentas.includes(4)) {
                analisis += '<p><strong>Cuentas con historial Acreimex:</strong> Evaluadas segun ultimo pago y historico (monto directo ingresado).</p>';
            }
            if (tiposCuentas.includes(5)) {
                analisis += '<p><strong>Tarjetas y servicios:</strong> Evaluadas segun saldo actual ($8,000 limite).</p>';
            }
            if (tiposCuentas.includes(6)) {
                analisis += '<p><strong>Creditos revolventes:</strong> Evaluadas segun fecha de apertura = ultima compra y pago minimo (1.6% del saldo actual).</p>';
            }
            if (tiposCuentas.includes(7)) {
                analisis += '<p><strong>Cuentas duplicadas:</strong> Identificadas y consideradas manualmente.</p>';
            }

            analisis += `
                <p><strong>Cuentas consideradas:</strong> ${cuentasConMonto.length} de ${Object.keys(cuentasRegistradas).length} evaluadas.</p>
                </div>
            `;

            return analisis;
        }

        function cerrarModalFicha() {
            document.getElementById('modalFichaCapacidad').style.display = 'none';
        }

        function imprimirFicha() {
            const contenido = document.getElementById('fichaContent').innerHTML;
            const ventanaImpresion = window.open('', '_blank');
            ventanaImpresion.document.write(`
                <html>
                <head>
                    <title>Ficha de Capacidad de Pago</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { border-collapse: collapse; width: 100%; }
                        th, td { border: 1px solid #ddd; padding: 8px; }
                        th { background-color: #3498db; color: white; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>${contenido}</body>
                </html>
            `);
            ventanaImpresion.document.close();
            ventanaImpresion.print();
        }

        // Cerrar modales al hacer click fuera
        window.addEventListener('click', function(event) {
            const modalRegistro = document.getElementById('modalRegistrarCuenta');
            const modalFicha = document.getElementById('modalFichaCapacidad');
            
            if (event.target === modalRegistro) {
                cerrarModal();
            }
            if (event.target === modalFicha) {
                cerrarModalFicha();
            }
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cd64cb062a81549',t:'MTc3MTAwNjQwNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>